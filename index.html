<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iron Ridge Fire Department - Time Clock System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        #root {
            min-height: 100vh;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Initialize Firebase -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB6Yb0Ol0ThmzKPipRIWblVm_wtEDrcKas",
            authDomain: "irfd-time-clock.firebaseapp.com",
            projectId: "irfd-time-clock",
            storageBucket: "irfd-time-clock.firebasestorage.app",
            messagingSenderId: "595563301703",
            appId: "1:595563301703:web:b2625cb98faa3679ea1a62"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Firebase storage wrapper to match the window.storage API used in the app
        window.storage = {
            async get(key, shared) {
                try {
                    const doc = await db.collection('irfd-data').doc(key).get();
                    if (doc.exists) {
                        return { key, value: doc.data().value, shared };
                    }
                    return null;
                } catch (error) {
                    console.error('Firebase get error:', error);
                    return null;
                }
            },
            async set(key, value, shared) {
                try {
                    await db.collection('irfd-data').doc(key).set({ value, shared, updatedAt: new Date() });
                    return { key, value, shared };
                } catch (error) {
                    console.error('Firebase set error:', error);
                    return null;
                }
            },
            async delete(key, shared) {
                try {
                    await db.collection('irfd-data').doc(key).delete();
                    return { key, deleted: true, shared };
                } catch (error) {
                    console.error('Firebase delete error:', error);
                    return null;
                }
            },
            async list(prefix, shared) {
                try {
                    const snapshot = await db.collection('irfd-data').get();
                    const keys = [];
                    snapshot.forEach(doc => {
                        if (!prefix || doc.id.startsWith(prefix)) {
                            keys.push(doc.id);
                        }
                    });
                    return { keys, prefix, shared };
                } catch (error) {
                    console.error('Firebase list error:', error);
                    return { keys: [], prefix, shared };
                }
            }
        };
    </script>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Lucide React icon components
        const Clock = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );
        
        const Users = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        );
        
        const LogIn = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                <polyline points="10 17 15 12 10 7"></polyline>
                <line x1="15" y1="12" x2="3" y2="12"></line>
            </svg>
        );
        
        const LogOut = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        );
        
        const Settings = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6"></path>
                <path d="m4.93 4.93 4.24 4.24m5.66 5.66 4.24 4.24"></path>
                <path d="m4.93 19.07 4.24-4.24m5.66-5.66 4.24-4.24"></path>
            </svg>
        );
        
        const Plus = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );
        
        const Edit2 = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );
        
        const Trash2 = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );
        
        const Save = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
        );
        
        const X = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );
        
        const Download = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );
        
        const Calendar = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );
        

// Activity types for fire department operations (default)
const ACTIVITY_TYPES = [

// Activity types for fire department operations (default)
const ACTIVITY_TYPES = [
  'Station Duty',
  'Training',
  'Emergency Response',
  'Maintenance',
  'Administrative',
  'Special Event',
  'Other'
];

const TimeClockApp = () => {
  // Main state management
  const [members, setMembers] = useState([]);
  const [timeEntries, setTimeEntries] = useState([]);
  const [activityTypes, setActivityTypes] = useState(ACTIVITY_TYPES);
  const [currentTime, setCurrentTime] = useState(new Date());
  const [view, setView] = useState('clock'); // 'clock' or 'admin'
  const [adminPassword, setAdminPassword] = useState('');
  const [adminUsers, setAdminUsers] = useState([
    { username: 'admin', password: 'Irfdchief2200@', role: 'Admin' }
  ]);
  const [currentAdmin, setCurrentAdmin] = useState(null);
  const [changingPasswordFor, setChangingPasswordFor] = useState(null);
  const [isAdminAuthenticated, setIsAdminAuthenticated] = useState(false);
  const [selectedMember, setSelectedMember] = useState(null);
  const [activityType, setActivityType] = useState('Station Duty');
  
  // Admin state
  const [editingMember, setEditingMember] = useState(null);
  const [editingEntry, setEditingEntry] = useState(null);
  const [newMemberName, setNewMemberName] = useState('');
  const [filterMember, setFilterMember] = useState('all');
  const [filterActivity, setFilterActivity] = useState('all');
  const [dateRange, setDateRange] = useState({ start: '', end: '' });
  const [newActivityType, setNewActivityType] = useState('');
  const [editingActivityType, setEditingActivityType] = useState(null);
  const [notes, setNotes] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  
  // Modal state (moved to parent to prevent reset on re-render)
  const [showPunchModal, setShowPunchModal] = useState(false);
  const [selectedMemberForPunch, setSelectedMemberForPunch] = useState(null);
  const [punchType, setPunchType] = useState(null);
  const [tempActivityType, setTempActivityType] = useState('Station Duty');
  const [tempNotes, setTempNotes] = useState('');

  // Track last CSV export date
  const [lastExportDate, setLastExportDate] = useState(null);
  const [announcement, setAnnouncement] = useState('');
  const [calendarEvents, setCalendarEvents] = useState([]);
  const [editingCalendarEvent, setEditingCalendarEvent] = useState(null);
  const [recurringEventOverrides, setRecurringEventOverrides] = useState([]);

  // Load data from persistent storage on mount
  useEffect(() => {
    const loadData = async () => {
      // Initialize with Iron Ridge Fire Department roster as fallback
      const irfdMembers = [
        { id: '1', name: 'BAHR, MOLLY', badgeNumber: '101', active: true },
        { id: '2', name: 'BOECK, JASON', badgeNumber: '102', active: true },
        { id: '3', name: 'BURGESS, TIMOTHY', badgeNumber: '103', active: true },
        { id: '4', name: 'CACCHIONE, GUNNAR', badgeNumber: '104', active: true },
        { id: '5', name: 'CARLSON, EMILY', badgeNumber: '105', active: true },
        { id: '6', name: 'DIETRICH, MARK', badgeNumber: '106', active: true },
        { id: '7', name: 'ERSBO, BILLY', badgeNumber: '107', active: true },
        { id: '8', name: 'FELICHT, DAVID', badgeNumber: '108', active: true },
        { id: '9', name: 'HAZELBIERS, MATTHEW', badgeNumber: '109', active: true },
        { id: '10', name: 'KELLER, JASON', badgeNumber: '110', active: true },
        { id: '11', name: 'KELLER, KELLY', badgeNumber: '111', active: true },
        { id: '12', name: 'LEHNERT, PAUL', badgeNumber: '112', active: true },
        { id: '13', name: 'MARVIN, JACK', badgeNumber: '113', active: true },
        { id: '14', name: 'MOLDENHAUER, LOUISA', badgeNumber: '114', active: true },
        { id: '15', name: 'MOLDENHAUER, NICK', badgeNumber: '115', active: true },
        { id: '16', name: 'OMAN, MARK', badgeNumber: '116', active: true },
        { id: '17', name: 'PRASSLER, CALEB', badgeNumber: '117', active: true },
        { id: '18', name: 'ROBENHORST, ARIANNA', badgeNumber: '118', active: true },
        { id: '19', name: 'SCHELLINGER, CURT', badgeNumber: '119', active: true },
        { id: '20', name: 'SCHELLINGER, SCOTT', badgeNumber: '120', active: true },
        { id: '21', name: 'SCHUMACHER, RICK', badgeNumber: '121', active: true },
        { id: '22', name: 'SELLNOW, DERRICK', badgeNumber: '122', active: true },
        { id: '23', name: 'SELLNOW, LAURA', badgeNumber: '123', active: true },
        { id: '24', name: 'SELLNOW, RANDY', badgeNumber: '124', active: true },
        { id: '25', name: 'TWAROOKUS, KEVIN', badgeNumber: '125', active: true },
        { id: '26', name: 'WENINGER, KEN', badgeNumber: '126', active: true },
        { id: '27', name: 'WILLMAN, NEIL', badgeNumber: '127', active: true },
        { id: '28', name: 'YOUNGECK, BRIAN', badgeNumber: '128', active: true }
      ];
      
      try {
        // Load members
        const membersResult = await window.storage.get('irfd-members', true);
        if (membersResult) {
          setMembers(JSON.parse(membersResult.value));
        } else {
          setMembers(irfdMembers);
          await window.storage.set('irfd-members', JSON.stringify(irfdMembers), true);
        }

        // Load time entries
        const entriesResult = await window.storage.get('irfd-entries', true);
        if (entriesResult) {
          setTimeEntries(JSON.parse(entriesResult.value));
        } else {
          // Start with no time entries - members will clock in as needed
          setTimeEntries([]);
          await window.storage.set('irfd-entries', JSON.stringify([]), true);
        }

        // Load activity types
        const activityTypesResult = await window.storage.get('irfd-activity-types', true);
        if (activityTypesResult) {
          setActivityTypes(JSON.parse(activityTypesResult.value));
        } else {
          await window.storage.set('irfd-activity-types', JSON.stringify(ACTIVITY_TYPES), true);
        }

        // Load last export date
        const lastExportResult = await window.storage.get('irfd-last-export', true);
        if (lastExportResult) {
          setLastExportDate(lastExportResult.value);
        }

        // Load announcement
        const announcementResult = await window.storage.get('irfd-announcement', true);
        if (announcementResult) {
          setAnnouncement(announcementResult.value);
        }

        // Load calendar events
        const calendarResult = await window.storage.get('irfd-calendar', true);
        if (calendarResult) {
          setCalendarEvents(JSON.parse(calendarResult.value));
        }

        // Load recurring event overrides
        const overridesResult = await window.storage.get('irfd-calendar-overrides', true);
        if (overridesResult) {
          setRecurringEventOverrides(JSON.parse(overridesResult.value));
        }

        // Load admin users
        const adminUsersResult = await window.storage.get('irfd-admin-users', true);
        if (adminUsersResult) {
          setAdminUsers(JSON.parse(adminUsersResult.value));
        }
      } catch (error) {
        console.error('Error loading data:', error);
        // Fallback: set members even if storage fails
        setMembers(irfdMembers);
        setTimeEntries([]);
        setActivityTypes(ACTIVITY_TYPES);
      }
    };

    loadData();
  }, []);

  // Update current time every second (but not when modal is open or on admin view)
  useEffect(() => {
    const timer = setInterval(() => {
      if (!showPunchModal && view === 'clock') {
        setCurrentTime(new Date());
      }
    }, 1000);
    return () => clearInterval(timer);
  }, [showPunchModal, view]);

  // Save data to persistent storage
  const saveMembers = async (newMembers) => {
    setMembers(newMembers);
    try {
      await window.storage.set('irfd-members', JSON.stringify(newMembers), true);
    } catch (error) {
      console.error('Error saving members:', error);
    }
  };

  const saveTimeEntries = async (newEntries) => {
    setTimeEntries(newEntries);
    try {
      await window.storage.set('irfd-entries', JSON.stringify(newEntries), true);
    } catch (error) {
      console.error('Error saving time entries:', error);
    }
  };

  const saveActivityTypes = async (newTypes) => {
    setActivityTypes(newTypes);
    try {
      await window.storage.set('irfd-activity-types', JSON.stringify(newTypes), true);
    } catch (error) {
      console.error('Error saving activity types:', error);
    }
  };

  const saveCalendarEvents = async (events) => {
    setCalendarEvents(events);
    try {
      await window.storage.set('irfd-calendar', JSON.stringify(events), true);
    } catch (error) {
      console.error('Error saving calendar events:', error);
    }
  };

  const saveRecurringEventOverrides = async (overrides) => {
    setRecurringEventOverrides(overrides);
    try {
      await window.storage.set('irfd-calendar-overrides', JSON.stringify(overrides), true);
    } catch (error) {
      console.error('Error saving calendar overrides:', error);
    }
  };

  const saveAdminUsers = async (users) => {
    setAdminUsers(users);
    try {
      await window.storage.set('irfd-admin-users', JSON.stringify(users), true);
    } catch (error) {
      console.error('Error saving admin users:', error);
    }
  };

  // Calculate total hours for a member
  const calculateTotalHours = (memberId, startDate = null, endDate = null) => {
    const memberEntries = timeEntries.filter(e => e.memberId === memberId);
    let filteredEntries = memberEntries;

    if (startDate && endDate) {
      filteredEntries = memberEntries.filter(e => {
        const entryDate = new Date(e.clockIn);
        return entryDate >= new Date(startDate) && entryDate <= new Date(endDate);
      });
    }

    return filteredEntries.reduce((total, entry) => {
      if (entry.clockOut) {
        const hours = (new Date(entry.clockOut) - new Date(entry.clockIn)) / (1000 * 60 * 60);
        return total + hours;
      } else {
        const hours = (new Date() - new Date(entry.clockIn)) / (1000 * 60 * 60);
        return total + hours;
      }
    }, 0);
  };

  // Check if member is currently clocked in
  const isCurrentlyClockedIn = (memberId) => {
    return timeEntries.some(e => e.memberId === memberId && !e.clockOut);
  };

  // Clock in/out functions
  const handleClockIn = (memberId, activity, userNotes = '') => {
    const newEntry = {
      id: Date.now().toString(),
      memberId,
      clockIn: new Date().toISOString(),
      clockOut: null,
      activityType: activity,
      notes: userNotes
    };
    saveTimeEntries([...timeEntries, newEntry]);
  };

  const handleClockOut = (memberId) => {
    const updatedEntries = timeEntries.map(entry => {
      if (entry.memberId === memberId && !entry.clockOut) {
        return { ...entry, clockOut: new Date().toISOString() };
      }
      return entry;
    });
    saveTimeEntries(updatedEntries);
  };

  // Admin functions
  const handleAdminLogin = (username, password) => {
    const user = adminUsers.find(u => u.username === username && u.password === password);
    if (user) {
      setCurrentAdmin(user);
      setIsAdminAuthenticated(true);
      setView('admin');
    } else {
      alert('Incorrect username or password');
    }
  };

  const handleAddMember = () => {
    if (newMemberName.trim()) {
      const newMember = {
        id: Date.now().toString(),
        name: newMemberName,
        badgeNumber: (100 + members.length + 1).toString(),
        active: true
      };
      saveMembers([...members, newMember]);
      setNewMemberName('');
    }
  };

  const handleDeleteMember = (memberId) => {
    if (confirm('Are you sure you want to delete this member?')) {
      saveMembers(members.filter(m => m.id !== memberId));
      saveTimeEntries(timeEntries.filter(e => e.memberId !== memberId));
    }
  };

  const handleUpdateMember = (updatedMember) => {
    saveMembers(members.map(m => m.id === updatedMember.id ? updatedMember : m));
    setEditingMember(null);
  };

  const handleDeleteEntry = (entryId) => {
    if (confirm('Are you sure you want to delete this time entry?')) {
      saveTimeEntries(timeEntries.filter(e => e.id !== entryId));
    }
  };

  const handleUpdateEntry = (updatedEntry) => {
    saveTimeEntries(timeEntries.map(e => e.id === updatedEntry.id ? updatedEntry : e));
    setEditingEntry(null);
  };

  const handleAddManualEntry = () => {
    const manualEntryMemberRef = document.getElementById('manual-entry-member');
    const manualEntryClockInRef = document.getElementById('manual-entry-clockin');
    const manualEntryClockOutRef = document.getElementById('manual-entry-clockout');
    const manualEntryActivityRef = document.getElementById('manual-entry-activity');
    const manualEntryNotesRef = document.getElementById('manual-entry-notes');

    const memberId = manualEntryMemberRef?.value;
    const clockIn = manualEntryClockInRef?.value;
    const clockOut = manualEntryClockOutRef?.value;
    const activityType = manualEntryActivityRef?.value;
    const notes = manualEntryNotesRef?.value;

    // Validate required fields
    if (!memberId || !clockIn || !activityType) {
      alert('Please fill in all required fields (Member, Clock In, and Activity Type)');
      return;
    }

    const entry = {
      id: Date.now().toString(),
      memberId: memberId,
      clockIn: new Date(clockIn).toISOString(),
      clockOut: clockOut ? new Date(clockOut).toISOString() : null,
      activityType: activityType,
      notes: notes || ''
    };

    saveTimeEntries([...timeEntries, entry]);
    
    // Reset form
    if (manualEntryMemberRef) manualEntryMemberRef.value = '';
    if (manualEntryClockInRef) manualEntryClockInRef.value = '';
    if (manualEntryClockOutRef) manualEntryClockOutRef.value = '';
    if (manualEntryActivityRef) manualEntryActivityRef.value = '';
    if (manualEntryNotesRef) manualEntryNotesRef.value = '';

    alert('Manual time entry added successfully!');
  };

  const handleAddActivityType = () => {
    if (newActivityType.trim() && !activityTypes.includes(newActivityType.trim())) {
      saveActivityTypes([...activityTypes, newActivityType.trim()]);
      setNewActivityType('');
    }
  };

  const handleDeleteActivityType = (activityType) => {
    saveActivityTypes(activityTypes.filter(t => t !== activityType));
    alert(`Activity type "${activityType}" has been deleted. This will not affect existing time entries.`);
  };

  const handleUpdateActivityType = (oldType, newType) => {
    if (newType.trim() && !activityTypes.includes(newType.trim())) {
      saveActivityTypes(activityTypes.map(t => t === oldType ? newType.trim() : t));
      setEditingActivityType(null);
    }
  };

  const exportToCSV = async () => {
    let data = timeEntries;
    if (filterMember !== 'all') {
      data = data.filter(e => e.memberId === filterMember);
    }
    if (filterActivity !== 'all') {
      data = data.filter(e => e.activityType === filterActivity);
    }
    if (dateRange.start && dateRange.end) {
      data = data.filter(e => {
        const entryDate = new Date(e.clockIn);
        return entryDate >= new Date(dateRange.start) && entryDate <= new Date(dateRange.end);
      });
    }

    const csv = [
      ['Member', 'Badge Number', 'Clock In', 'Clock Out', 'Activity Type', 'Notes', 'Hours'],
      ...data.map(entry => {
        const member = members.find(m => m.id === entry.memberId);
        const hours = entry.clockOut 
          ? ((new Date(entry.clockOut) - new Date(entry.clockIn)) / (1000 * 60 * 60)).toFixed(2)
          : 'In Progress';
        return [
          member?.name || 'Unknown',
          member?.badgeNumber || 'N/A',
          new Date(entry.clockIn).toLocaleString(),
          entry.clockOut ? new Date(entry.clockOut).toLocaleString() : 'N/A',
          entry.activityType,
          entry.notes || '',
          hours
        ];
      })
    ].map(row => row.map(cell => `"${cell}"`).join(','));

    const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `irfd-timeclock-${new Date().toISOString().split('T')[0]}.csv`;
    a.click();

    // Save export date
    const exportDate = new Date().toISOString();
    setLastExportDate(exportDate);
    try {
      await window.storage.set('irfd-last-export', exportDate, true);
    } catch (error) {
      console.error('Error saving export date:', error);
    }
  };

  const printReport = () => {
    let data = timeEntries;
    if (filterMember !== 'all') {
      data = data.filter(e => e.memberId === filterMember);
    }
    if (filterActivity !== 'all') {
      data = data.filter(e => e.activityType === filterActivity);
    }
    if (dateRange.start && dateRange.end) {
      data = data.filter(e => {
        const entryDate = new Date(e.clockIn);
        return entryDate >= new Date(dateRange.start) && entryDate <= new Date(dateRange.end);
      });
    }

    // Create print-friendly HTML
    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write(`
      <html>
        <head>
          <title>Iron Ridge Fire Department - Time Report</title>
          <style>
            body { 
              font-family: Arial, sans-serif; 
              padding: 20px;
              color: #333;
            }
            h1 {
              color: #8B1A1A;
              border-bottom: 3px solid #D4AF37;
              padding-bottom: 10px;
            }
            h2 {
              color: #8B1A1A;
              margin-top: 30px;
            }
            .filters {
              background: #f5f5f5;
              padding: 15px;
              margin: 20px 0;
              border-radius: 8px;
            }
            .filters p {
              margin: 5px 0;
            }
            table { 
              width: 100%; 
              border-collapse: collapse; 
              margin: 20px 0;
            }
            th { 
              background: #8B1A1A; 
              color: white; 
              padding: 12px; 
              text-align: left;
              font-weight: 600;
            }
            td { 
              padding: 10px; 
              border-bottom: 1px solid #ddd;
            }
            tr:nth-child(even) {
              background: #f9f9f9;
            }
            .summary {
              background: #f5f5f5;
              padding: 15px;
              margin: 20px 0;
              border-radius: 8px;
              border-left: 4px solid #D4AF37;
            }
            @media print {
              body { padding: 0; }
              button { display: none; }
            }
          </style>
        </head>
        <body>
          <h1>Iron Ridge Fire Department</h1>
          <h2>Time Clock Report</h2>
          
          <div class="filters">
            <p><strong>Report Date:</strong> ${new Date().toLocaleDateString()}</p>
            <p><strong>Member Filter:</strong> ${filterMember === 'all' ? 'All Members' : members.find(m => m.id === filterMember)?.name || 'Unknown'}</p>
            <p><strong>Activity Filter:</strong> ${filterActivity === 'all' ? 'All Activities' : filterActivity}</p>
            <p><strong>Date Range:</strong> ${dateRange.start && dateRange.end ? `${new Date(dateRange.start).toLocaleDateString()} - ${new Date(dateRange.end).toLocaleDateString()}` : 'All Dates'}</p>
            <p><strong>Total Entries:</strong> ${data.length}</p>
          </div>

          <table>
            <thead>
              <tr>
                <th>Member</th>
                <th>Badge #</th>
                <th>Clock In</th>
                <th>Clock Out</th>
                <th>Activity</th>
                <th>Hours</th>
              </tr>
            </thead>
            <tbody>
              ${data.map(entry => {
                const member = members.find(m => m.id === entry.memberId);
                const hours = entry.clockOut 
                  ? ((new Date(entry.clockOut) - new Date(entry.clockIn)) / (1000 * 60 * 60)).toFixed(2)
                  : 'In Progress';
                return `
                  <tr>
                    <td>${member?.name || 'Unknown'}</td>
                    <td>${member?.badgeNumber || 'N/A'}</td>
                    <td>${new Date(entry.clockIn).toLocaleString()}</td>
                    <td>${entry.clockOut ? new Date(entry.clockOut).toLocaleString() : 'In Progress'}</td>
                    <td>${entry.activityType}</td>
                    <td>${hours}</td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>

          <div class="summary">
            <h3>Total Hours by Member</h3>
            ${members
              .filter(m => filterMember === 'all' || m.id === filterMember)
              .map(member => {
                const memberEntries = data.filter(e => e.memberId === member.id);
                const totalHours = memberEntries.reduce((sum, entry) => {
                  if (entry.clockOut) {
                    return sum + ((new Date(entry.clockOut) - new Date(entry.clockIn)) / (1000 * 60 * 60));
                  }
                  return sum;
                }, 0);
                return totalHours > 0 ? `<p><strong>${member.name}:</strong> ${Math.floor(totalHours)}h ${Math.floor((totalHours % 1) * 60)}m</p>` : '';
              }).join('')}
          </div>

          <script>
            window.onload = function() {
              window.print();
            }
          </script>
        </body>
      </html>
    `);
    printWindow.document.close();
  };

  const formatTime = (date) => {
    return date.toLocaleTimeString('en-US', { 
      hour: '2-digit', 
      minute: '2-digit',
      second: '2-digit'
    });
  };

  const formatDate = (date) => {
    return date.toLocaleDateString('en-US', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  };

  const formatDuration = (hours) => {
    const h = Math.floor(hours);
    const m = Math.floor((hours - h) * 60);
    return `${h}h ${m}m`;
  };

  // Clock View Component
  const ClockView = () => {
    const handleMemberClick = React.useCallback((memberId) => {
      console.log('handleMemberClick called with memberId:', memberId);
      const isClockedIn = isCurrentlyClockedIn(memberId);
      console.log('isClockedIn:', isClockedIn);
      
      setSelectedMemberForPunch(memberId);
      setPunchType(isClockedIn ? 'out' : 'in');
      setTempActivityType(activityTypes && activityTypes.length > 0 ? activityTypes[0] : 'Station Duty');
      setShowPunchModal(true);
      
      console.log('State should be updated - showPunchModal should now be true');
    }, [activityTypes]);

    const handleActivityTypeChange = React.useCallback((e) => {
      setTempActivityType(e.target.value);
    }, []);

    const confirmPunch = () => {
      console.log('confirmPunch called');
      if (punchType === 'in') {
        handleClockIn(selectedMemberForPunch, tempActivityType, ''); // Empty string for notes - admin can add later
      } else {
        handleClockOut(selectedMemberForPunch);
      }
      setShowPunchModal(false);
      setSelectedMemberForPunch(null);
    };

    const cancelPunch = () => {
      console.log('cancelPunch called');
      setShowPunchModal(false);
      setSelectedMemberForPunch(null);
      setTempActivityType('Station Duty');
    };

    const selectedMemberData = members.find(m => m.id === selectedMemberForPunch);

    // Debug logging
    console.log('ClockView render - showPunchModal:', showPunchModal);
    console.log('ClockView render - selectedMemberForPunch:', selectedMemberForPunch);
    console.log('ClockView render - selectedMemberData:', selectedMemberData);
    console.log('ClockView render - members length:', members.length);

    return (
      <div style={{ padding: '2rem', maxWidth: '1400px', margin: '0 auto' }}>
        {/* Punch Modal */}
        {showPunchModal && selectedMemberData ? (
          <div 
            key={`modal-${selectedMemberForPunch}`}
            style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              background: 'rgba(0,0,0,0.7)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 1000,
              padding: '2rem'
            }}
            onClick={cancelPunch}
          >
            <div 
              key={`modal-content-${selectedMemberForPunch}`}
              style={{
                background: 'white',
                borderRadius: '16px',
                padding: '2.5rem',
                maxWidth: '600px',
                width: '100%',
                boxShadow: '0 20px 60px rgba(0,0,0,0.3)'
              }}
              onClick={(e) => e.stopPropagation()}
            >
              <h2 style={{ margin: '0 0 1rem 0', fontSize: '1.8rem', color: '#2c3e50' }}>
                {punchType === 'in' ? 'Clock In' : 'Clock Out'}
              </h2>
              
              <div style={{
                background: '#f8f9fa',
                padding: '1rem',
                borderRadius: '8px',
                marginBottom: '1.5rem'
              }}>
                <div style={{ fontSize: '1.2rem', fontWeight: 'bold', color: '#2c3e50' }}>
                  {selectedMemberData.name}
                </div>
                <div style={{ fontSize: '0.9rem', color: '#666' }}>
                  Badge #{selectedMemberData.badgeNumber}
                </div>
              </div>

              {punchType === 'in' ? (
                <>
                  {/* Activity Type Selection */}
                  <div style={{ marginBottom: '2rem' }}>
                    <label style={{ 
                      display: 'block', 
                      marginBottom: '0.5rem', 
                      fontWeight: '600', 
                      fontSize: '1rem',
                      color: '#2c3e50'
                    }}>
                      Activity Type:
                    </label>
                    <select
                      key={`activity-${selectedMemberForPunch}`}
                      value={tempActivityType}
                      onChange={handleActivityTypeChange}
                      style={{
                        width: '100%',
                        padding: '0.875rem',
                        fontSize: '1rem',
                        borderRadius: '8px',
                        border: '2px solid #e0e0e0',
                        background: 'white',
                        cursor: 'pointer'
                      }}
                    >
                      {activityTypes.map(type => (
                        <option key={type} value={type}>{type}</option>
                      ))}
                    </select>
                  </div>
                </>
              ) : (
                <div style={{
                  background: '#fff3cd',
                  border: '2px solid #ffc107',
                  padding: '1.5rem',
                  borderRadius: '8px',
                  marginBottom: '2rem',
                  textAlign: 'center'
                }}>
                  <p style={{ margin: 0, fontSize: '1.1rem', color: '#856404' }}>
                    Are you sure you want to clock out?
                  </p>
                </div>
              )}

              {/* Buttons */}
              <div style={{ display: 'flex', gap: '1rem' }}>
                <button
                  type="button"
                  onClick={confirmPunch}
                  style={{
                    flex: 1,
                    padding: '1rem',
                    background: punchType === 'in' ? '#27ae60' : '#e74c3c',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    fontSize: '1.1rem',
                    fontWeight: 'bold',
                    cursor: 'pointer'
                  }}
                >
                  {punchType === 'in' ? 'Confirm Clock In' : 'Confirm Clock Out'}
                </button>
                <button
                  type="button"
                  onClick={cancelPunch}
                  style={{
                    flex: 1,
                    padding: '1rem',
                    background: '#95a5a6',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    fontSize: '1.1rem',
                    fontWeight: 'bold',
                    cursor: 'pointer'
                  }}
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        ) : null}

        {/* Header */}
        <div style={{
          background: 'linear-gradient(135deg, #8B1A1A 0%, #6B0F0F 100%)',
          color: 'white',
          padding: '2rem',
          borderRadius: '16px',
          marginBottom: '2rem',
          boxShadow: '0 10px 30px rgba(139, 26, 26, 0.4)',
          border: '3px solid #D4AF37'
        }}>
          {/* Top Row - Logo/Title on left, Admin Panel on right */}
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: '1.5rem', marginBottom: '1rem' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '1.5rem' }}>
              <div style={{
                width: '80px',
                height: '80px',
                borderRadius: '50%',
                border: '3px solid #D4AF37',
                background: 'white',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontSize: '2.5rem'
              }}>
                ðŸš’
              </div>
              <div>
                <h1 style={{ margin: '0 0 0.25rem 0', fontSize: '2.2rem', fontWeight: 'bold', fontFamily: 'system-ui', color: '#D4AF37' }}>
                  Iron Ridge Fire Department
                </h1>
                <p style={{ margin: 0, fontSize: '1.1rem', opacity: 0.95 }}>Time Clock System</p>
              </div>
            </div>
            <button
              onClick={() => {
                setView('admin');
                setAdminPassword('');
              }}
              style={{
                background: '#D4AF37',
                border: 'none',
                color: '#8B1A1A',
                padding: '0.875rem 1.75rem',
                borderRadius: '8px',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: '0.5rem',
                fontSize: '1rem',
                fontWeight: 'bold',
                transition: 'all 0.2s',
                boxShadow: '0 4px 12px rgba(212, 175, 55, 0.3)'
              }}
              onMouseOver={(e) => {
                e.currentTarget.style.background = '#FFD700';
                e.currentTarget.style.transform = 'translateY(-2px)';
              }}
              onMouseOut={(e) => {
                e.currentTarget.style.background = '#D4AF37';
                e.currentTarget.style.transform = 'translateY(0)';
              }}
            >
              <Settings size={20} />
              Admin Panel
            </button>
          </div>

          {/* Bottom Row - Department Calendar Centered */}
          <div style={{ display: 'flex', justifyContent: 'center', paddingTop: '1rem', borderTop: '1px solid rgba(212, 175, 55, 0.3)' }}>
            <button
              onClick={() => setView('calendar')}
              style={{
                background: '#3498db',
                border: 'none',
                color: 'white',
                padding: '0.875rem 2rem',
                borderRadius: '8px',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: '0.5rem',
                fontSize: '1.05rem',
                fontWeight: 'bold',
                transition: 'all 0.2s',
                boxShadow: '0 4px 12px rgba(52, 152, 219, 0.3)'
              }}
              onMouseOver={(e) => {
                e.currentTarget.style.background = '#5dade2';
                e.currentTarget.style.transform = 'translateY(-2px)';
              }}
              onMouseOut={(e) => {
                e.currentTarget.style.background = '#3498db';
                e.currentTarget.style.transform = 'translateY(0)';
              }}
            >
              <Calendar size={20} />
              Department Calendar
            </button>
          </div>
        </div>

        {/* Clock and Upcoming Events Row */}
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '1.5rem', marginBottom: '2rem' }}>
          {/* Current Time Display */}
          <div style={{
            background: 'linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%)',
            color: '#D4AF37',
            padding: '1.5rem',
            borderRadius: '12px',
            textAlign: 'center',
            boxShadow: '0 4px 12px rgba(0,0,0,0.2)',
            border: '2px solid #8B1A1A'
          }}>
            <div style={{ fontSize: '2.5rem', fontWeight: 'bold', fontFamily: 'monospace', marginBottom: '0.5rem' }}>
              {formatTime(currentTime)}
            </div>
            <div style={{ fontSize: '1rem', opacity: 0.9, color: 'white' }}>
              {formatDate(currentTime)}
            </div>
          </div>

          {/* Upcoming Events (Next 3 Days) */}
          <div style={{
            background: 'linear-gradient(135deg, #27ae60 0%, #229954 100%)',
            color: 'white',
            padding: '1.5rem',
            borderRadius: '12px',
            boxShadow: '0 4px 12px rgba(39, 174, 96, 0.3)',
            border: '2px solid #D4AF37',
            minHeight: '150px'
          }}>
            <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.2rem', fontWeight: 'bold', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
              ðŸ“… Upcoming (Next 3 Days)
            </h3>
            {(() => {
              // Generate all event instances
              const generateEventInstances = () => {
                const instances = [];
                const currentYear = new Date().getFullYear();
                
                calendarEvents.forEach(event => {
                  if (event.isRecurring && event.recurrenceRule) {
                    for (let month = 0; month < 12; month++) {
                      const weekOfMonth = event.recurrenceRule.weekOfMonth;
                      const dayOfWeek = event.recurrenceRule.dayOfWeek;
                      
                      let targetDate;
                      if (weekOfMonth === -1) {
                        const lastDay = new Date(currentYear, month + 1, 0);
                        let day = lastDay.getDate();
                        while (new Date(currentYear, month, day).getDay() !== dayOfWeek && day > 0) {
                          day--;
                        }
                        targetDate = new Date(currentYear, month, day);
                      } else {
                        const daysInMonth = new Date(currentYear, month + 1, 0).getDate();
                        let count = 0;
                        for (let day = 1; day <= daysInMonth; day++) {
                          if (new Date(currentYear, month, day).getDay() === dayOfWeek) {
                            count++;
                            if (count === weekOfMonth) {
                              targetDate = new Date(currentYear, month, day);
                              break;
                            }
                          }
                        }
                      }
                      
                      if (targetDate) {
                        const dateStr = targetDate.toISOString().split('T')[0];
                        instances.push({
                          ...event,
                          date: dateStr,
                          instanceId: `${event.id}-${dateStr}`
                        });
                      }
                    }
                  } else {
                    instances.push(event);
                  }
                });
                
                // Apply overrides
                return instances.map(event => {
                  if (event.instanceId) {
                    const override = recurringEventOverrides.find(o => o.instanceId === event.instanceId);
                    if (override) {
                      return { ...event, ...override.changes };
                    }
                  }
                  return event;
                });
              };

              const allEvents = generateEventInstances();
              const today = new Date();
              today.setHours(0, 0, 0, 0);
              const threeDaysLater = new Date(today);
              threeDaysLater.setDate(today.getDate() + 3);
              
              const upcomingEvents = allEvents
                .filter(e => {
                  const eventDate = new Date(e.date);
                  return eventDate >= today && eventDate <= threeDaysLater;
                })
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(0, 3);

              if (upcomingEvents.length === 0) {
                return (
                  <div style={{ 
                    textAlign: 'center', 
                    opacity: 0.7, 
                    fontSize: '0.9rem',
                    fontStyle: 'italic',
                    paddingTop: '1rem'
                  }}>
                    No events in the next 3 days
                  </div>
                );
              }

              return upcomingEvents.map((event, idx) => {
                const eventDate = new Date(event.date + 'T00:00:00');
                eventDate.setHours(0, 0, 0, 0);
                const todayMidnight = new Date(today);
                todayMidnight.setHours(0, 0, 0, 0);
                const daysUntil = Math.round((eventDate - todayMidnight) / (1000 * 60 * 60 * 24));
                
                return (
                  <div
                    key={idx}
                    style={{
                      background: 'rgba(255, 255, 255, 0.2)',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      marginBottom: '0.5rem',
                      borderLeft: '4px solid #D4AF37'
                    }}
                  >
                    <div style={{ fontWeight: 'bold', fontSize: '0.95rem', marginBottom: '0.25rem' }}>
                      {event.title}
                      {daysUntil === 0 && <span style={{ marginLeft: '0.5rem', padding: '0.2rem 0.5rem', background: '#e74c3c', borderRadius: '4px', fontSize: '0.7rem' }}>TODAY</span>}
                    </div>
                    <div style={{ fontSize: '0.85rem', opacity: 0.9 }}>
                      {eventDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}
                      {event.time && ` â€¢ ${event.time}`}
                      {daysUntil > 0 && ` â€¢ ${daysUntil} day${daysUntil > 1 ? 's' : ''}`}
                    </div>
                  </div>
                );
              });
            })()}
          </div>
        </div>

        {/* Announcement Banner */}
        {announcement && (
          <div style={{
            background: 'linear-gradient(135deg, #3498db 0%, #2980b9 100%)',
            color: 'white',
            padding: '1.5rem',
            borderRadius: '12px',
            marginBottom: '2rem',
            boxShadow: '0 4px 12px rgba(52, 152, 219, 0.3)',
            border: '2px solid #D4AF37'
          }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
              <div style={{ fontSize: '2rem' }}>ðŸ“¢</div>
              <div style={{ flex: 1 }}>
                <h3 style={{ margin: '0 0 0.5rem 0', fontSize: '1.2rem', fontWeight: 'bold' }}>
                  Station Announcement
                </h3>
                <p style={{ margin: 0, fontSize: '1rem', lineHeight: '1.5' }}>
                  {announcement}
                </p>
              </div>
            </div>
          </div>
        )}

        {/* Member Buttons Grid */}
        <div style={{
          background: 'white',
          padding: '2rem',
          borderRadius: '16px',
          boxShadow: '0 4px 20px rgba(0,0,0,0.1)',
          marginBottom: '2rem'
        }}>
          <h2 style={{ margin: '0 0 1.5rem 0', fontSize: '1.8rem', textAlign: 'center', color: '#2c3e50' }}>
            Select Your Name to Clock In/Out
          </h2>
          
          <div style={{
            display: 'grid',
            gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))',
            gap: '1rem'
          }}>
            {members
              .filter(m => m.active)
              .sort((a, b) => a.name.localeCompare(b.name))
              .map(member => {
                const isClockedIn = isCurrentlyClockedIn(member.id);
                const activeEntry = isClockedIn ? timeEntries.find(e => e.memberId === member.id && !e.clockOut) : null;
                const elapsedTime = activeEntry 
                  ? (new Date() - new Date(activeEntry.clockIn)) / (1000 * 60 * 60)
                  : 0;
                
                return (
                  <button
                    key={member.id}
                    type="button"
                    onClick={() => {
                      console.log('Button clicked for member:', member.name, member.id);
                      handleMemberClick(member.id);
                    }}
                    style={{
                      background: isClockedIn 
                        ? 'linear-gradient(135deg, #2d5016 0%, #1e3610 100%)' 
                        : 'linear-gradient(135deg, #8B1A1A 0%, #6B0F0F 100%)',
                      color: 'white',
                      border: isClockedIn ? '3px solid #D4AF37' : '3px solid #D4AF37',
                      borderRadius: '12px',
                      padding: '1.5rem',
                      cursor: 'pointer',
                      textAlign: 'left',
                      transition: 'all 0.2s',
                      boxShadow: isClockedIn 
                        ? '0 4px 12px rgba(45, 80, 22, 0.4)' 
                        : '0 4px 12px rgba(139, 26, 26, 0.4)',
                      position: 'relative'
                    }}
                    onMouseOver={(e) => {
                      e.currentTarget.style.transform = 'translateY(-2px)';
                      e.currentTarget.style.boxShadow = isClockedIn 
                        ? '0 6px 16px rgba(45, 80, 22, 0.5)' 
                        : '0 6px 16px rgba(139, 26, 26, 0.5)';
                    }}
                    onMouseOut={(e) => {
                      e.currentTarget.style.transform = 'translateY(0)';
                      e.currentTarget.style.boxShadow = isClockedIn 
                        ? '0 4px 12px rgba(45, 80, 22, 0.4)' 
                        : '0 4px 12px rgba(139, 26, 26, 0.4)';
                    }}
                  >
                    {/* Status Indicator */}
                    <div style={{
                      position: 'absolute',
                      top: '1rem',
                      right: '1rem',
                      width: '12px',
                      height: '12px',
                      borderRadius: '50%',
                      background: '#D4AF37',
                      boxShadow: '0 0 8px rgba(212, 175, 55, 0.8)',
                      animation: isClockedIn ? 'pulse 2s infinite' : 'none'
                    }} />

                    <div style={{ fontSize: '1.2rem', fontWeight: 'bold', marginBottom: '0.25rem' }}>
                      {member.name}
                    </div>
                    <div style={{ fontSize: '0.9rem', opacity: 0.9, marginBottom: '0.75rem' }}>
                      Badge #{member.badgeNumber}
                    </div>
                    
                    <div style={{
                      background: 'rgba(255,255,255,0.2)',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      fontSize: '0.95rem'
                    }}>
                      <div style={{ fontWeight: 'bold', marginBottom: '0.25rem' }}>
                        {isClockedIn ? 'âœ“ CLOCKED IN' : 'â—‹ CLOCKED OUT'}
                      </div>
                      {isClockedIn && activeEntry && (
                        <>
                          <div style={{ fontSize: '0.85rem', opacity: 0.95 }}>
                            {activeEntry.activityType}
                          </div>
                          <div style={{ fontSize: '0.85rem', opacity: 0.95, marginTop: '0.25rem' }}>
                            Time: {formatDuration(elapsedTime)}
                          </div>
                        </>
                      )}
                    </div>
                  </button>
                );
              })}
          </div>
        </div>

        {/* Currently Clocked In Summary */}
        <div style={{
          background: 'white',
          padding: '2rem',
          borderRadius: '16px',
          boxShadow: '0 4px 20px rgba(0,0,0,0.1)'
        }}>
          <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.5rem', color: '#2c3e50' }}>
            Currently Clocked In: {members.filter(m => isCurrentlyClockedIn(m.id)).length} Member{members.filter(m => isCurrentlyClockedIn(m.id)).length !== 1 ? 's' : ''}
          </h3>
          
          {members.filter(m => isCurrentlyClockedIn(m.id)).length === 0 ? (
            <p style={{ color: '#666', fontSize: '1rem', margin: '1rem 0' }}>
              No members are currently clocked in.
            </p>
          ) : (
            <div style={{ fontSize: '0.95rem', color: '#666' }}>
              {members
                .filter(m => isCurrentlyClockedIn(m.id))
                .map(member => {
                  const activeEntry = timeEntries.find(e => e.memberId === member.id && !e.clockOut);
                  return (
                    <div key={member.id} style={{ 
                      display: 'inline-block',
                      background: '#e8f5e9',
                      padding: '0.5rem 0.75rem',
                      borderRadius: '6px',
                      margin: '0.25rem',
                      fontSize: '0.9rem'
                    }}>
                      <strong>{member.name}</strong> - {activeEntry?.activityType}
                      {activeEntry?.notes && ` (${activeEntry.notes})`}
                    </div>
                  );
                })}
            </div>
          )}
        </div>
      </div>
    );
  };

  // Admin View Component
  // Calendar View Component
  const CalendarView = () => {
    const [selectedMonth, setSelectedMonth] = React.useState(new Date().getMonth());
    const [selectedYear, setSelectedYear] = React.useState(new Date().getFullYear());
    const [selectedDate, setSelectedDate] = React.useState(null);

    // Generate all event instances including recurring ones for the year
    const generateEventInstances = () => {
      const instances = [];
      const currentYear = selectedYear;
      
      calendarEvents.forEach(event => {
        if (event.isRecurring && event.recurrenceRule) {
          const rule = event.recurrenceRule;
          
          if (rule.type === 'weekly') {
            // Weekly: Every week on specified day of week
            const startDate = new Date(currentYear, 0, 1);
            const endDate = new Date(currentYear, 11, 31);
            let currentDate = new Date(startDate);
            
            // Find first occurrence of the day
            while (currentDate.getDay() !== rule.dayOfWeek) {
              currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // Generate weekly instances
            while (currentDate <= endDate) {
              instances.push({
                ...event,
                date: currentDate.toISOString().split('T')[0],
                instanceId: `${event.id}-${currentDate.toISOString().split('T')[0]}`
              });
              currentDate = new Date(currentDate);
              currentDate.setDate(currentDate.getDate() + 7); // Add 1 week
            }
          } else if (rule.type === 'biweekly') {
            // Bi-weekly: Every 2 weeks on specified day of week
            const startDate = new Date(currentYear, 0, 1);
            const endDate = new Date(currentYear, 11, 31);
            let currentDate = new Date(startDate);
            
            // Find first occurrence of the day
            while (currentDate.getDay() !== rule.dayOfWeek) {
              currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // Generate bi-weekly instances
            while (currentDate <= endDate) {
              instances.push({
                ...event,
                date: currentDate.toISOString().split('T')[0],
                instanceId: `${event.id}-${currentDate.toISOString().split('T')[0]}`
              });
              currentDate = new Date(currentDate);
              currentDate.setDate(currentDate.getDate() + 14); // Add 2 weeks
            }
          } else if (rule.type === 'monthly') {
            // Monthly: Every month on specified week and day
            for (let month = 0; month < 12; month++) {
              const daysInMonth = new Date(currentYear, month + 1, 0).getDate();
              const weekOfMonth = rule.weekOfMonth;
              const dayOfWeek = rule.dayOfWeek;
              
              let targetDate;
              if (weekOfMonth === -1) {
                // Last occurrence
                const lastDay = new Date(currentYear, month + 1, 0);
                let day = lastDay.getDate();
                while (new Date(currentYear, month, day).getDay() !== dayOfWeek && day > 0) {
                  day--;
                }
                targetDate = new Date(currentYear, month, day);
              } else {
                // Nth occurrence (1st, 2nd, 3rd, 4th)
                let count = 0;
                for (let day = 1; day <= daysInMonth; day++) {
                  if (new Date(currentYear, month, day).getDay() === dayOfWeek) {
                    count++;
                    if (count === weekOfMonth) {
                      targetDate = new Date(currentYear, month, day);
                      break;
                    }
                  }
                }
              }
              
              if (targetDate) {
                instances.push({
                  ...event,
                  date: targetDate.toISOString().split('T')[0],
                  instanceId: `${event.id}-${currentYear}-${month}`
                });
              }
            }
          } else if (rule.type === 'bimonthly') {
            // Bi-monthly: Every 2 months on specified week and day
            for (let month = 0; month < 12; month += 2) {
              const daysInMonth = new Date(currentYear, month + 1, 0).getDate();
              const weekOfMonth = rule.weekOfMonth;
              const dayOfWeek = rule.dayOfWeek;
              
              let targetDate;
              if (weekOfMonth === -1) {
                // Last occurrence
                const lastDay = new Date(currentYear, month + 1, 0);
                let day = lastDay.getDate();
                while (new Date(currentYear, month, day).getDay() !== dayOfWeek && day > 0) {
                  day--;
                }
                targetDate = new Date(currentYear, month, day);
              } else {
                // Nth occurrence
                let count = 0;
                for (let day = 1; day <= daysInMonth; day++) {
                  if (new Date(currentYear, month, day).getDay() === dayOfWeek) {
                    count++;
                    if (count === weekOfMonth) {
                      targetDate = new Date(currentYear, month, day);
                      break;
                    }
                  }
                }
              }
              
              if (targetDate) {
                instances.push({
                  ...event,
                  date: targetDate.toISOString().split('T')[0],
                  instanceId: `${event.id}-${currentYear}-${month}`
                });
              }
            }
          }
        } else {
          // Single occurrence event
          instances.push(event);
        }
      });
      
      return instances;
    };

    const allEventsRaw = generateEventInstances();
    
    // Apply overrides to recurring event instances
    const allEvents = allEventsRaw.map(event => {
      if (event.instanceId) {
        // This is a recurring event instance, check for overrides
        const override = recurringEventOverrides.find(o => o.instanceId === event.instanceId);
        if (override) {
          return { ...event, ...override.changes };
        }
      }
      return event;
    });
    
    // Get events for a specific date
    const getEventsForDate = (date) => {
      const dateStr = date.toISOString().split('T')[0];
      return allEvents.filter(e => e.date === dateStr);
    };

    // Get upcoming events (next 10 days)
    const getUpcomingEvents = () => {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const tenDaysLater = new Date(today);
      tenDaysLater.setDate(today.getDate() + 10);
      
      return allEvents
        .filter(e => {
          const eventDate = new Date(e.date);
          return eventDate >= today && eventDate <= tenDaysLater;
        })
        .sort((a, b) => new Date(a.date) - new Date(b.date));
    };

    // Generate calendar grid
    const generateCalendar = () => {
      const firstDay = new Date(selectedYear, selectedMonth, 1);
      const lastDay = new Date(selectedYear, selectedMonth + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDayOfWeek = firstDay.getDay();
      
      const days = [];
      
      // Add empty cells for days before month starts
      for (let i = 0; i < startingDayOfWeek; i++) {
        days.push(null);
      }
      
      // Add days of month
      for (let day = 1; day <= daysInMonth; day++) {
        days.push(day);
      }
      
      return days;
    };

    const calendar = generateCalendar();
    const upcomingEvents = getUpcomingEvents();
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

    return (
      <div style={{ padding: '2rem', maxWidth: '1400px', margin: '0 auto' }}>
        {/* Header */}
        <div style={{
          background: 'linear-gradient(135deg, #8B1A1A 0%, #6B0F0F 100%)',
          color: 'white',
          padding: '2rem',
          borderRadius: '16px',
          marginBottom: '2rem',
          boxShadow: '0 10px 30px rgba(139, 26, 26, 0.4)',
          border: '3px solid #D4AF37'
        }}>
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: '1.5rem' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '1.5rem' }}>
              <div style={{
                width: '80px',
                height: '80px',
                borderRadius: '50%',
                border: '3px solid #D4AF37',
                background: 'white',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontSize: '2.5rem'
              }}>
                ðŸ“…
              </div>
              <div>
                <h1 style={{ margin: '0 0 0.25rem 0', fontSize: '2.2rem', fontWeight: 'bold', fontFamily: 'system-ui', color: '#D4AF37' }}>
                  Department Calendar
                </h1>
                <p style={{ margin: 0, fontSize: '1.1rem', opacity: 0.95 }}>Training, Events & Important Dates</p>
              </div>
            </div>
            <button
              onClick={() => setView('clock')}
              style={{
                background: '#D4AF37',
                border: 'none',
                color: '#8B1A1A',
                padding: '0.875rem 1.75rem',
                borderRadius: '8px',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: '0.5rem',
                fontSize: '1rem',
                fontWeight: 'bold',
                transition: 'all 0.2s',
                boxShadow: '0 4px 12px rgba(212, 175, 55, 0.3)'
              }}
            >
              Back to Clock
            </button>
          </div>
        </div>

        {/* Upcoming Events (Next 10 Days) */}
        <div style={{
          background: 'white',
          padding: '2rem',
          borderRadius: '12px',
          boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
          marginBottom: '2rem',
          border: '2px solid #D4AF37'
        }}>
          <h2 style={{ margin: '0 0 1.5rem 0', fontSize: '1.5rem', color: '#8B1A1A' }}>
            ðŸ“Œ Upcoming Events (Next 10 Days)
          </h2>
          {upcomingEvents.length > 0 ? (
            <div style={{ display: 'grid', gap: '1rem' }}>
              {upcomingEvents.map((event, idx) => {
                const eventDate = new Date(event.date + 'T00:00:00');
                eventDate.setHours(0, 0, 0, 0);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const daysUntil = Math.round((eventDate - today) / (1000 * 60 * 60 * 24));
                
                return (
                  <div
                    key={event.instanceId || event.id}
                    style={{
                      padding: '1.25rem',
                      border: '2px solid #D4AF37',
                      borderRadius: '12px',
                      background: daysUntil === 0 ? '#fff3cd' : 'linear-gradient(135deg, #fff9e6 0%, #ffffff 100%)'
                    }}
                  >
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', flexWrap: 'wrap', gap: '1rem' }}>
                      <div style={{ flex: 1 }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '0.5rem' }}>
                          <h3 style={{ margin: 0, fontSize: '1.3rem', color: '#8B1A1A' }}>
                            {event.title}
                          </h3>
                          {daysUntil === 0 && (
                            <span style={{
                              padding: '0.25rem 0.75rem',
                              background: '#e74c3c',
                              color: 'white',
                              borderRadius: '12px',
                              fontSize: '0.75rem',
                              fontWeight: 'bold'
                            }}>
                              TODAY
                            </span>
                          )}
                          {event.isRecurring && (
                            <span style={{
                              padding: '0.25rem 0.75rem',
                              background: '#3498db',
                              color: 'white',
                              borderRadius: '12px',
                              fontSize: '0.75rem',
                              fontWeight: 'bold'
                            }}>
                              ðŸ”„ RECURRING
                            </span>
                          )}
                        </div>
                        <div style={{ display: 'flex', gap: '1.5rem', flexWrap: 'wrap', marginBottom: '0.5rem' }}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', color: '#666', fontSize: '0.95rem' }}>
                            <strong>
                              {eventDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}
                              {daysUntil > 0 && ` (${daysUntil} day${daysUntil > 1 ? 's' : ''})`}
                            </strong>
                          </div>
                          {event.time && (
                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', color: '#666', fontSize: '0.95rem' }}>
                              ðŸ• <strong>{event.time}</strong>
                            </div>
                          )}
                        </div>
                        <p style={{ margin: 0, color: '#555', lineHeight: '1.5' }}>
                          {event.description}
                        </p>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          ) : (
            <div style={{
              padding: '2rem',
              textAlign: 'center',
              color: '#999',
              fontSize: '1rem',
              fontStyle: 'italic'
            }}>
              No events in the next 10 days
            </div>
          )}
        </div>

        {/* Monthly Calendar Grid */}
        <div style={{
          background: 'white',
          padding: '2rem',
          borderRadius: '12px',
          boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
        }}>
          {/* Month/Year Selector */}
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem', flexWrap: 'wrap', gap: '1rem' }}>
            <button
              onClick={() => {
                if (selectedMonth === 0) {
                  setSelectedMonth(11);
                  setSelectedYear(selectedYear - 1);
                } else {
                  setSelectedMonth(selectedMonth - 1);
                }
              }}
              style={{
                padding: '0.75rem 1.5rem',
                background: '#3498db',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                cursor: 'pointer',
                fontSize: '1rem',
                fontWeight: 'bold'
              }}
            >
              â† Previous
            </button>
            
            <h2 style={{ margin: 0, fontSize: '1.8rem', color: '#8B1A1A' }}>
              {monthNames[selectedMonth]} {selectedYear}
            </h2>
            
            <button
              onClick={() => {
                if (selectedMonth === 11) {
                  setSelectedMonth(0);
                  setSelectedYear(selectedYear + 1);
                } else {
                  setSelectedMonth(selectedMonth + 1);
                }
              }}
              style={{
                padding: '0.75rem 1.5rem',
                background: '#3498db',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                cursor: 'pointer',
                fontSize: '1rem',
                fontWeight: 'bold'
              }}
            >
              Next â†’
            </button>
          </div>

          {/* Calendar Grid */}
          <div style={{
            display: 'grid',
            gridTemplateColumns: 'repeat(7, 1fr)',
            gap: '0.5rem'
          }}>
            {/* Day headers */}
            {dayNames.map(day => (
              <div
                key={day}
                style={{
                  padding: '0.75rem',
                  textAlign: 'center',
                  fontWeight: 'bold',
                  color: '#8B1A1A',
                  background: '#f5f5f5',
                  borderRadius: '8px'
                }}
              >
                {day}
              </div>
            ))}
            
            {/* Calendar days */}
            {calendar.map((day, idx) => {
              if (day === null) {
                return <div key={`empty-${idx}`} />;
              }
              
              const date = new Date(selectedYear, selectedMonth, day);
              const dateStr = date.toISOString().split('T')[0];
              const eventsOnDay = getEventsForDate(date);
              const isToday = dateStr === new Date().toISOString().split('T')[0];
              const hasEvents = eventsOnDay.length > 0;
              
              return (
                <div
                  key={day}
                  onClick={() => hasEvents ? setSelectedDate(date) : null}
                  style={{
                    padding: '0.75rem',
                    minHeight: '80px',
                    border: isToday ? '3px solid #D4AF37' : hasEvents ? '2px solid #3498db' : '1px solid #e0e0e0',
                    borderRadius: '8px',
                    cursor: hasEvents ? 'pointer' : 'default',
                    background: isToday ? '#fff9e6' : hasEvents ? '#e3f2fd' : 'white',
                    transition: 'all 0.2s',
                    position: 'relative'
                  }}
                  onMouseOver={(e) => {
                    if (hasEvents) {
                      e.currentTarget.style.transform = 'scale(1.05)';
                      e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
                    }
                  }}
                  onMouseOut={(e) => {
                    if (hasEvents) {
                      e.currentTarget.style.transform = 'scale(1)';
                      e.currentTarget.style.boxShadow = 'none';
                    }
                  }}
                >
                  <div style={{ fontWeight: 'bold', fontSize: '1.1rem', marginBottom: '0.25rem' }}>
                    {day}
                  </div>
                  {hasEvents && (
                    <div style={{ fontSize: '0.75rem', color: '#3498db', fontWeight: '600' }}>
                      {eventsOnDay.length} event{eventsOnDay.length > 1 ? 's' : ''}
                    </div>
                  )}
                  {hasEvents && eventsOnDay.map((e, i) => (
                    <div
                      key={i}
                      style={{
                        fontSize: '0.7rem',
                        background: '#3498db',
                        color: 'white',
                        padding: '2px 4px',
                        borderRadius: '4px',
                        marginTop: '2px',
                        overflow: 'hidden',
                        textOverflow: 'ellipsis',
                        whiteSpace: 'nowrap'
                      }}
                    >
                      {e.time || ''} {e.title}
                    </div>
                  ))}
                </div>
              );
            })}
          </div>
        </div>

        {/* Selected Date Modal */}
        {selectedDate && (
          <div
            style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              background: 'rgba(0,0,0,0.7)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 1000,
              padding: '2rem'
            }}
            onClick={() => setSelectedDate(null)}
          >
            <div
              style={{
                background: 'white',
                borderRadius: '16px',
                padding: '2rem',
                maxWidth: '600px',
                width: '100%',
                maxHeight: '80vh',
                overflowY: 'auto',
                border: '3px solid #D4AF37'
              }}
              onClick={(e) => e.stopPropagation()}
            >
              <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.5rem', color: '#8B1A1A' }}>
                Events on {selectedDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}
              </h3>
              
              <div style={{ display: 'grid', gap: '1rem', marginBottom: '1.5rem' }}>
                {getEventsForDate(selectedDate).map(event => (
                  <div
                    key={event.instanceId || event.id}
                    style={{
                      padding: '1rem',
                      border: '2px solid #e0e0e0',
                      borderRadius: '8px',
                      background: '#f9f9f9'
                    }}
                  >
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', gap: '1rem' }}>
                      <div style={{ flex: 1 }}>
                        <h4 style={{ margin: '0 0 0.5rem 0', fontSize: '1.2rem', color: '#8B1A1A' }}>
                          {event.title}
                          {event.isRecurring && (
                            <span style={{
                              marginLeft: '0.5rem',
                              padding: '0.25rem 0.5rem',
                              background: '#3498db',
                              color: 'white',
                              borderRadius: '8px',
                              fontSize: '0.7rem',
                              fontWeight: 'bold'
                            }}>
                              ðŸ”„ RECURRING
                            </span>
                          )}
                        </h4>
                        {event.time && (
                          <p style={{ margin: '0 0 0.5rem 0', color: '#666', fontWeight: '600' }}>
                            ðŸ• {event.time}
                          </p>
                        )}
                        <p style={{ margin: 0, color: '#555', lineHeight: '1.5' }}>
                          {event.description || <em style={{ color: '#999' }}>No description</em>}
                        </p>
                      </div>
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          setEditingCalendarEvent(event);
                        }}
                        style={{
                          padding: '0.5rem 1rem',
                          background: '#3498db',
                          color: 'white',
                          border: 'none',
                          borderRadius: '6px',
                          cursor: 'pointer',
                          fontSize: '0.9rem',
                          fontWeight: 'bold',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '0.5rem',
                          whiteSpace: 'nowrap'
                        }}
                      >
                        <Edit2 size={16} />
                        Edit
                      </button>
                    </div>
                  </div>
                ))}
              </div>
              
              <button
                onClick={() => setSelectedDate(null)}
                style={{
                  width: '100%',
                  padding: '0.875rem',
                  background: '#95a5a6',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  fontSize: '1rem',
                  fontWeight: 'bold'
                }}
              >
                Close
              </button>
            </div>
          </div>
        )}
      </div>
    );
  };

  const AdminView = () => {
    const passwordInputRef = React.useRef(null);
    const usernameInputRef = React.useRef(null);
    const newMemberNameRef = React.useRef(null);
    const newActivityTypeRef = React.useRef(null);
    const editMemberNameRef = React.useRef(null);
    const editMemberBadgeRef = React.useRef(null);

    const handleAdminLoginClick = () => {
      const username = usernameInputRef.current ? usernameInputRef.current.value : '';
      const password = passwordInputRef.current ? passwordInputRef.current.value : '';
      const user = adminUsers.find(u => u.username === username && u.password === password);
      if (user) {
        setCurrentAdmin(user);
        setIsAdminAuthenticated(true);
        setView('admin');
      } else {
        alert('Incorrect username or password');
      }
    };

    const handleShowPasswordToggle = React.useCallback(() => {
      setShowPassword(prev => !prev);
    }, []);

    const handleAddMemberClick = () => {
      const memberName = newMemberNameRef.current ? newMemberNameRef.current.value : '';
      if (memberName.trim()) {
        const newMember = {
          id: Date.now().toString(),
          name: memberName,
          badgeNumber: (100 + members.length + 1).toString(),
          active: true
        };
        // Add new member and sort alphabetically by name
        const updatedMembers = [...members, newMember].sort((a, b) => a.name.localeCompare(b.name));
        saveMembers(updatedMembers);
        if (newMemberNameRef.current) {
          newMemberNameRef.current.value = '';
        }
      }
    };

    const handleAddActivityTypeClick = () => {
      const activityTypeName = newActivityTypeRef.current ? newActivityTypeRef.current.value : '';
      if (activityTypeName.trim() && !activityTypes.includes(activityTypeName.trim())) {
        saveActivityTypes([...activityTypes, activityTypeName.trim()]);
        if (newActivityTypeRef.current) {
          newActivityTypeRef.current.value = '';
        }
      }
    };

    const handleStartEditMember = (member) => {
      setEditingMember(member);
      // Use setTimeout to ensure the input is rendered before we try to set its value
      setTimeout(() => {
        if (editMemberNameRef.current) {
          editMemberNameRef.current.value = member.name;
        }
        if (editMemberBadgeRef.current) {
          editMemberBadgeRef.current.value = member.badgeNumber;
        }
      }, 0);
    };

    const handleSaveEditMember = () => {
      if (editingMember && editMemberNameRef.current && editMemberBadgeRef.current) {
        const updatedMember = {
          ...editingMember,
          name: editMemberNameRef.current.value,
          badgeNumber: editMemberBadgeRef.current.value
        };
        // Update member and sort alphabetically by name
        const updatedMembers = members.map(m => m.id === updatedMember.id ? updatedMember : m)
                                      .sort((a, b) => a.name.localeCompare(b.name));
        saveMembers(updatedMembers);
        setEditingMember(null);
      }
    };

    if (!isAdminAuthenticated) {
      return (
        <div style={{
          minHeight: '100vh',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          background: 'linear-gradient(135deg, #8B1A1A 0%, #6B0F0F 100%)',
          padding: '2rem'
        }}>
          <div style={{
            background: 'white',
            padding: '3rem',
            borderRadius: '16px',
            boxShadow: '0 20px 60px rgba(0,0,0,0.3)',
            maxWidth: '400px',
            width: '100%',
            border: '4px solid #D4AF37'
          }}>
            <div style={{ textAlign: 'center', marginBottom: '2rem' }}>
              <div style={{
                width: '100px',
                height: '100px',
                margin: '0 auto 1rem',
                borderRadius: '50%',
                border: '4px solid #D4AF37',
                background: 'white',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontSize: '4rem'
              }}>
                ðŸš’
              </div>
              <h2 style={{ margin: '0 0 0.5rem 0', fontSize: '1.8rem', color: '#8B1A1A' }}>Admin Access</h2>
              <p style={{ margin: 0, color: '#666' }}>Enter credentials to continue</p>
            </div>
            
            <div style={{ marginBottom: '1rem' }}>
              <input
                ref={usernameInputRef}
                type="text"
                onKeyPress={(e) => e.key === 'Enter' && passwordInputRef.current && passwordInputRef.current.focus()}
                placeholder="Username"
                autoComplete="username"
                style={{
                  width: '100%',
                  padding: '0.875rem',
                  fontSize: '1rem',
                  borderRadius: '8px',
                  border: '2px solid #e0e0e0',
                  boxSizing: 'border-box'
                }}
              />
            </div>

            <div style={{ position: 'relative', marginBottom: '1rem' }}>
              <input
                ref={passwordInputRef}
                type={showPassword ? "text" : "password"}
                onKeyPress={(e) => e.key === 'Enter' && handleAdminLoginClick()}
                placeholder="Admin password"
                autoComplete="off"
                style={{
                  width: '100%',
                  padding: '0.875rem',
                  paddingRight: '3rem',
                  fontSize: '1rem',
                  borderRadius: '8px',
                  border: '2px solid #e0e0e0',
                  boxSizing: 'border-box'
                }}
              />
              <button
                type="button"
                onClick={handleShowPasswordToggle}
                style={{
                  position: 'absolute',
                  right: '0.5rem',
                  top: '50%',
                  transform: 'translateY(-50%)',
                  background: 'transparent',
                  border: 'none',
                  color: '#8B1A1A',
                  cursor: 'pointer',
                  padding: '0.5rem',
                  fontSize: '0.85rem',
                  fontWeight: '600'
                }}
              >
                {showPassword ? 'Hide' : 'Show'}
              </button>
            </div>
            
            <button
              onClick={handleAdminLoginClick}
              style={{
                width: '100%',
                padding: '0.875rem',
                background: '#8B1A1A',
                color: '#D4AF37',
                border: 'none',
                borderRadius: '8px',
                fontSize: '1rem',
                fontWeight: '600',
                cursor: 'pointer',
                marginBottom: '1rem'
              }}
            >
              Login
            </button>

            <button
              onClick={() => setView('clock')}
              style={{
                width: '100%',
                padding: '0.875rem',
                background: '#f8f9fa',
                color: '#8B1A1A',
                border: '2px solid #8B1A1A',
                borderRadius: '8px',
                fontSize: '1rem',
                fontWeight: '500',
                cursor: 'pointer'
              }}
            >
              Back to Clock
            </button>
          </div>
        </div>
      );
    }

    const filteredEntries = timeEntries.filter(e => {
      if (filterMember !== 'all' && e.memberId !== filterMember) return false;
      if (filterActivity !== 'all' && e.activityType !== filterActivity) return false;
      if (dateRange.start && dateRange.end) {
        const entryDate = new Date(e.clockIn);
        return entryDate >= new Date(dateRange.start) && entryDate <= new Date(dateRange.end);
      }
      return true;
    });

    return (
      <div style={{ padding: '2rem', maxWidth: '1400px', margin: '0 auto' }}>
        {/* Header */}
        <div style={{
          background: 'linear-gradient(135deg, #8B1A1A 0%, #6B0F0F 100%)',
          color: 'white',
          padding: '2rem',
          borderRadius: '16px',
          marginBottom: '2rem',
          boxShadow: '0 10px 30px rgba(139, 26, 26, 0.4)',
          border: '3px solid #D4AF37'
        }}>
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: '1rem' }}>
            <div>
              <h1 style={{ margin: '0 0 0.5rem 0', fontSize: '2rem', fontWeight: 'bold', color: '#D4AF37' }}>
                Admin Panel
              </h1>
              <p style={{ margin: 0, opacity: 0.9 }}>Manage members and time entries</p>
            </div>
            <div style={{ display: 'flex', gap: '0.5rem' }}>
              <button
                onClick={() => {
                  setView('clock');
                }}
                style={{
                  background: '#D4AF37',
                  border: 'none',
                  color: '#8B1A1A',
                  padding: '0.75rem 1.5rem',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  fontSize: '1rem',
                  fontWeight: 'bold'
                }}
              >
                Back to Clock
              </button>
              <button
                onClick={() => {
                  setIsAdminAuthenticated(false);
                  setAdminPassword('');
                  setView('clock');
                }}
                style={{
                  background: '#e74c3c',
                  border: 'none',
                  color: 'white',
                  padding: '0.75rem 1.5rem',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  fontSize: '1rem',
                  fontWeight: 'bold'
                }}
              >
                Logout
              </button>
            </div>
          </div>
        </div>

        {/* Data Export Reminder Banner */}
        {(() => {
          if (!lastExportDate) {
            return (
              <div style={{
                background: 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)',
                color: 'white',
                padding: '1rem 1.5rem',
                borderRadius: '12px',
                marginBottom: '2rem',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
                flexWrap: 'wrap',
                gap: '1rem',
                boxShadow: '0 4px 12px rgba(231, 76, 60, 0.3)',
                border: '2px solid #D4AF37'
              }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                  <Download size={24} />
                  <div>
                    <strong style={{ display: 'block', fontSize: '1.1rem' }}>âš ï¸ No Backup Found</strong>
                    <span style={{ fontSize: '0.9rem', opacity: 0.9 }}>
                      You haven't exported your data yet. Regular monthly backups are recommended for data retention!
                    </span>
                  </div>
                </div>
                <button
                  onClick={() => setSelectedTab('Reports')}
                  style={{
                    background: '#D4AF37',
                    color: '#8B1A1A',
                    border: 'none',
                    padding: '0.75rem 1.5rem',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    fontWeight: 'bold',
                    fontSize: '1rem'
                  }}
                >
                  Backup Now
                </button>
              </div>
            );
          }

          const daysSinceExport = Math.floor((new Date() - new Date(lastExportDate)) / (1000 * 60 * 60 * 24));
          
          if (daysSinceExport >= 30) {
            return (
              <div style={{
                background: 'linear-gradient(135deg, #f39c12 0%, #e67e22 100%)',
                color: 'white',
                padding: '1rem 1.5rem',
                borderRadius: '12px',
                marginBottom: '2rem',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
                flexWrap: 'wrap',
                gap: '1rem',
                boxShadow: '0 4px 12px rgba(243, 156, 18, 0.3)',
                border: '2px solid #D4AF37'
              }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                  <Download size={24} />
                  <div>
                    <strong style={{ display: 'block', fontSize: '1.1rem' }}>â° Monthly Backup Reminder</strong>
                    <span style={{ fontSize: '0.9rem', opacity: 0.9 }}>
                      Last backup: {daysSinceExport} days ago ({new Date(lastExportDate).toLocaleDateString()}) - Time to export again!
                    </span>
                  </div>
                </div>
                <button
                  onClick={() => setSelectedTab('Reports')}
                  style={{
                    background: '#D4AF37',
                    color: '#8B1A1A',
                    border: 'none',
                    padding: '0.75rem 1.5rem',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    fontWeight: 'bold',
                    fontSize: '1rem'
                  }}
                >
                  Backup Now
                </button>
              </div>
            );
          }

          // Show subtle success indicator if backed up recently
          if (daysSinceExport < 30) {
            return (
              <div style={{
                background: 'rgba(46, 204, 113, 0.1)',
                color: '#27ae60',
                padding: '0.75rem 1.5rem',
                borderRadius: '8px',
                marginBottom: '1rem',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
                border: '1px solid rgba(46, 204, 113, 0.3)'
              }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '0.9rem' }}>
                  <span>âœ“</span>
                  <span>Data backed up: {daysSinceExport === 0 ? 'Today' : `${daysSinceExport} day${daysSinceExport > 1 ? 's' : ''} ago`} - Next backup due in {30 - daysSinceExport} days</span>
                </div>
              </div>
            );
          }
        })()}

        {/* Tabs */}
        <div style={{ display: 'flex', gap: '1rem', marginBottom: '2rem', flexWrap: 'wrap' }}>
          {['Members', 'Time Entries', 'Activity Types', 'Announcements', 'Calendar', 'Admin Users', 'Reports'].map(tab => (
            <button
              key={tab}
              onClick={() => setSelectedTab(tab)}
              style={{
                padding: '0.75rem 1.5rem',
                background: selectedTab === tab ? '#667eea' : 'white',
                color: selectedTab === tab ? 'white' : '#333',
                border: 'none',
                borderRadius: '8px',
                cursor: 'pointer',
                fontSize: '1rem',
                fontWeight: '500',
                boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
              }}
            >
              {tab}
            </button>
          ))}
        </div>

        {/* Members Tab */}
        {selectedTab === 'Members' && (
          <div>
            {/* Add Member */}
            <div style={{
              background: 'white',
              padding: '1.5rem',
              borderRadius: '12px',
              marginBottom: '2rem',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
            }}>
              <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.3rem' }}>Add New Member</h3>
              <div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap' }}>
                <input
                  ref={newMemberNameRef}
                  type="text"
                  placeholder="Member name"
                  onKeyDown={(e) => {
                    if (e.key === 'Enter') {
                      e.preventDefault();
                      handleAddMemberClick();
                    }
                  }}
                  style={{
                    flex: 1,
                    minWidth: '250px',
                    padding: '0.75rem',
                    fontSize: '1rem',
                    borderRadius: '8px',
                    border: '2px solid #e0e0e0'
                  }}
                />
                <button
                  type="button"
                  onClick={handleAddMemberClick}
                  style={{
                    padding: '0.75rem 1.5rem',
                    background: '#27ae60',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0.5rem',
                    fontSize: '1rem',
                    fontWeight: '500'
                  }}
                >
                  <Plus size={20} />
                  Add Member
                </button>
              </div>
            </div>

            {/* Members List */}
            <div style={{
              background: 'white',
              padding: '1.5rem',
              borderRadius: '12px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
            }}>
              <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.3rem' }}>Members ({members.length})</h3>
              <div style={{ overflowX: 'auto' }}>
                <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                  <thead>
                    <tr style={{ borderBottom: '2px solid #e0e0e0' }}>
                      <th style={{ padding: '1rem', textAlign: 'left', fontWeight: '600' }}>Name</th>
                      <th style={{ padding: '1rem', textAlign: 'left', fontWeight: '600' }}>Badge #</th>
                      <th style={{ padding: '1rem', textAlign: 'left', fontWeight: '600' }}>Status</th>
                      <th style={{ padding: '1rem', textAlign: 'left', fontWeight: '600' }}>Total Hours</th>
                      <th style={{ padding: '1rem', textAlign: 'left', fontWeight: '600' }}>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {members.map(member => (
                      <tr key={member.id} style={{ borderBottom: '1px solid #f0f0f0' }}>
                        <td style={{ padding: '1rem' }}>
                          {editingMember?.id === member.id ? (
                            <input
                              ref={editMemberNameRef}
                              type="text"
                              defaultValue={member.name}
                              style={{
                                padding: '0.5rem',
                                borderRadius: '4px',
                                border: '1px solid #e0e0e0',
                                width: '100%'
                              }}
                            />
                          ) : (
                            member.name
                          )}
                        </td>
                        <td style={{ padding: '1rem' }}>
                          {editingMember?.id === member.id ? (
                            <input
                              ref={editMemberBadgeRef}
                              type="text"
                              defaultValue={member.badgeNumber}
                              style={{
                                padding: '0.5rem',
                                borderRadius: '4px',
                                border: '1px solid #e0e0e0',
                                width: '100%'
                              }}
                            />
                          ) : (
                            member.badgeNumber
                          )}
                        </td>
                        <td style={{ padding: '1rem' }}>
                          <span 
                            onClick={() => {
                              const updatedMember = { ...member, active: !member.active };
                              saveMembers(members.map(m => m.id === member.id ? updatedMember : m));
                            }}
                            style={{
                              padding: '0.25rem 0.75rem',
                              borderRadius: '20px',
                              fontSize: '0.85rem',
                              fontWeight: '500',
                              background: member.active ? '#d4edda' : '#f8d7da',
                              color: member.active ? '#155724' : '#721c24',
                              cursor: 'pointer',
                              userSelect: 'none',
                              transition: 'all 0.2s'
                            }}
                            onMouseOver={(e) => {
                              e.currentTarget.style.opacity = '0.8';
                              e.currentTarget.style.transform = 'scale(1.05)';
                            }}
                            onMouseOut={(e) => {
                              e.currentTarget.style.opacity = '1';
                              e.currentTarget.style.transform = 'scale(1)';
                            }}
                            title="Click to toggle active/inactive"
                          >
                            {member.active ? 'Active' : 'Inactive'}
                          </span>
                        </td>
                        <td style={{ padding: '1rem', fontWeight: '600' }}>
                          {formatDuration(calculateTotalHours(member.id))}
                        </td>
                        <td style={{ padding: '1rem' }}>
                          <div style={{ display: 'flex', gap: '0.5rem' }}>
                            {editingMember?.id === member.id ? (
                              <>
                                <button
                                  onClick={handleSaveEditMember}
                                  style={{
                                    padding: '0.5rem',
                                    background: '#27ae60',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: 'pointer'
                                  }}
                                >
                                  <Save size={16} />
                                </button>
                                <button
                                  onClick={() => setEditingMember(null)}
                                  style={{
                                    padding: '0.5rem',
                                    background: '#95a5a6',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: 'pointer'
                                  }}
                                >
                                  <X size={16} />
                                </button>
                              </>
                            ) : (
                              <>
                                <button
                                  onClick={() => handleStartEditMember(member)}
                                  style={{
                                    padding: '0.5rem',
                                    background: '#3498db',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: 'pointer'
                                  }}
                                >
                                  <Edit2 size={16} />
                                </button>
                                <button
                                  onClick={() => handleDeleteMember(member.id)}
                                  style={{
                                    padding: '0.5rem',
                                    background: '#e74c3c',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: 'pointer'
                                  }}
                                >
                                  <Trash2 size={16} />
                                </button>
                              </>
                            )}
                          </div>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        )}

        {/* Activity Types Tab */}
        {selectedTab === 'Activity Types' && (
          <div>
            {/* Add Activity Type */}
            <div style={{
              background: 'white',
              padding: '1.5rem',
              borderRadius: '12px',
              marginBottom: '2rem',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
            }}>
              <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.3rem' }}>Add New Activity Type</h3>
              <div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap' }}>
                <input
                  ref={newActivityTypeRef}
                  type="text"
                  placeholder="Activity type name"
                  onKeyDown={(e) => {
                    if (e.key === 'Enter') {
                      e.preventDefault();
                      handleAddActivityTypeClick();
                    }
                  }}
                  style={{
                    flex: 1,
                    minWidth: '250px',
                    padding: '0.75rem',
                    fontSize: '1rem',
                    borderRadius: '8px',
                    border: '2px solid #e0e0e0'
                  }}
                />
                <button
                  type="button"
                  onClick={handleAddActivityTypeClick}
                  style={{
                    padding: '0.75rem 1.5rem',
                    background: '#27ae60',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0.5rem',
                    fontSize: '1rem',
                    fontWeight: '500'
                  }}
                >
                  <Plus size={20} />
                  Add Activity Type
                </button>
              </div>
            </div>

            {/* Activity Types List */}
            <div style={{
              background: 'white',
              padding: '1.5rem',
              borderRadius: '12px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
            }}>
              <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.3rem' }}>Activity Types ({activityTypes.length})</h3>
              <div style={{ display: 'grid', gap: '1rem' }}>
                {activityTypes.map(type => (
                  <div
                    key={type}
                    style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      padding: '1rem',
                      background: '#f8f9fa',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0'
                    }}
                  >
                    {editingActivityType === type ? (
                      <input
                        type="text"
                        defaultValue={type}
                        onKeyPress={(e) => {
                          if (e.key === 'Enter') {
                            handleUpdateActivityType(type, e.target.value);
                          }
                        }}
                        style={{
                          flex: 1,
                          padding: '0.5rem',
                          fontSize: '1rem',
                          borderRadius: '6px',
                          border: '2px solid #667eea',
                          marginRight: '1rem'
                        }}
                        autoFocus
                      />
                    ) : (
                      <span style={{ fontSize: '1.1rem', fontWeight: '500' }}>{type}</span>
                    )}
                    <div style={{ display: 'flex', gap: '0.5rem' }}>
                      {editingActivityType === type ? (
                        <>
                          <button
                            onClick={(e) => {
                              const input = e.target.parentElement.parentElement.querySelector('input');
                              handleUpdateActivityType(type, input.value);
                            }}
                            style={{
                              padding: '0.5rem',
                              background: '#27ae60',
                              color: 'white',
                              border: 'none',
                              borderRadius: '6px',
                              cursor: 'pointer'
                            }}
                          >
                            <Save size={16} />
                          </button>
                          <button
                            onClick={() => setEditingActivityType(null)}
                            style={{
                              padding: '0.5rem',
                              background: '#95a5a6',
                              color: 'white',
                              border: 'none',
                              borderRadius: '6px',
                              cursor: 'pointer'
                            }}
                          >
                            <X size={16} />
                          </button>
                        </>
                      ) : (
                        <>
                          <button
                            onClick={() => setEditingActivityType(type)}
                            style={{
                              padding: '0.5rem',
                              background: '#3498db',
                              color: 'white',
                              border: 'none',
                              borderRadius: '6px',
                              cursor: 'pointer'
                            }}
                          >
                            <Edit2 size={16} />
                          </button>
                          <button
                            onClick={() => handleDeleteActivityType(type)}
                            style={{
                              padding: '0.5rem',
                              background: '#e74c3c',
                              color: 'white',
                              border: 'none',
                              borderRadius: '6px',
                              cursor: 'pointer'
                            }}
                          >
                            <Trash2 size={16} />
                          </button>
                        </>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}

        {/* Time Entries Tab */}
        {selectedTab === 'Time Entries' && (
          <div>
            {/* Manual Entry Form */}
            <div style={{
              background: 'white',
              padding: '1.5rem',
              borderRadius: '12px',
              marginBottom: '2rem',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
              border: '2px solid #D4AF37'
            }}>
              <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.3rem', color: '#8B1A1A' }}>
                <Plus size={20} style={{ verticalAlign: 'middle', marginRight: '0.5rem' }} />
                Add Manual Time Entry
              </h3>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem', marginBottom: '1rem' }}>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Member *
                  </label>
                  <select
                    id="manual-entry-member"
                    defaultValue=""
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  >
                    <option value="">Select Member</option>
                    {members.filter(m => m.active).map(m => (
                      <option key={m.id} value={m.id}>{m.name}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Clock In *
                  </label>
                  <input
                    id="manual-entry-clockin"
                    type="datetime-local"
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  />
                </div>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Clock Out
                  </label>
                  <input
                    id="manual-entry-clockout"
                    type="datetime-local"
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  />
                </div>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Activity Type *
                  </label>
                  <select
                    id="manual-entry-activity"
                    defaultValue=""
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  >
                    <option value="">Select Activity</option>
                    {activityTypes.map(type => (
                      <option key={type} value={type}>{type}</option>
                    ))}
                  </select>
                </div>
              </div>
              <div style={{ marginBottom: '1rem' }}>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                  Notes
                </label>
                <textarea
                  id="manual-entry-notes"
                  placeholder="Optional notes about this time entry"
                  style={{
                    width: '100%',
                    padding: '0.75rem',
                    borderRadius: '8px',
                    border: '2px solid #e0e0e0',
                    fontSize: '1rem',
                    minHeight: '80px',
                    fontFamily: 'inherit',
                    resize: 'vertical'
                  }}
                />
              </div>
              <button
                onClick={handleAddManualEntry}
                style={{
                  padding: '0.75rem 1.5rem',
                  background: '#27ae60',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '0.5rem',
                  fontSize: '1rem',
                  fontWeight: '500'
                }}
              >
                <Plus size={20} />
                Add Entry
              </button>
            </div>

            {/* Filters */}
            <div style={{
              background: 'white',
              padding: '1.5rem',
              borderRadius: '12px',
              marginBottom: '2rem',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
            }}>
              <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.3rem' }}>Filter Entries</h3>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem' }}>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Member
                  </label>
                  <select
                    value={filterMember}
                    onChange={(e) => setFilterMember(e.target.value)}
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  >
                    <option value="all">All Members</option>
                    {members.map(m => (
                      <option key={m.id} value={m.id}>{m.name}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Activity Type
                  </label>
                  <select
                    value={filterActivity}
                    onChange={(e) => setFilterActivity(e.target.value)}
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  >
                    <option value="all">All Activities</option>
                    {activityTypes.map(type => (
                      <option key={type} value={type}>{type}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Start Date
                  </label>
                  <input
                    type="date"
                    value={dateRange.start}
                    onChange={(e) => setDateRange({...dateRange, start: e.target.value})}
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  />
                </div>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    End Date
                  </label>
                  <input
                    type="date"
                    value={dateRange.end}
                    onChange={(e) => setDateRange({...dateRange, end: e.target.value})}
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  />
                </div>
              </div>
            </div>

            {/* Entries List */}
            <div style={{
              background: 'white',
              padding: '1.5rem',
              borderRadius: '12px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
            }}>
              <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.3rem' }}>
                Time Entries ({filteredEntries.length})
              </h3>
              <div style={{ overflowX: 'auto' }}>
                <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                  <thead>
                    <tr style={{ borderBottom: '2px solid #e0e0e0' }}>
                      <th style={{ padding: '1rem', textAlign: 'left', fontWeight: '600' }}>Member</th>
                      <th style={{ padding: '1rem', textAlign: 'left', fontWeight: '600' }}>Clock In</th>
                      <th style={{ padding: '1rem', textAlign: 'left', fontWeight: '600' }}>Clock Out</th>
                      <th style={{ padding: '1rem', textAlign: 'left', fontWeight: '600' }}>Activity</th>
                      <th style={{ padding: '1rem', textAlign: 'left', fontWeight: '600' }}>Notes</th>
                      <th style={{ padding: '1rem', textAlign: 'left', fontWeight: '600' }}>Duration</th>
                      <th style={{ padding: '1rem', textAlign: 'left', fontWeight: '600' }}>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {filteredEntries.map(entry => {
                      const member = members.find(m => m.id === entry.memberId);
                      const duration = entry.clockOut
                        ? (new Date(entry.clockOut) - new Date(entry.clockIn)) / (1000 * 60 * 60)
                        : (new Date() - new Date(entry.clockIn)) / (1000 * 60 * 60);
                      
                      return (
                        <tr key={entry.id} style={{ borderBottom: '1px solid #f0f0f0' }}>
                          <td style={{ padding: '1rem', fontWeight: '500' }}>
                            {member?.name || 'Unknown'}
                          </td>
                          <td style={{ padding: '1rem' }}>
                            {new Date(entry.clockIn).toLocaleString()}
                          </td>
                          <td style={{ padding: '1rem' }}>
                            {entry.clockOut ? new Date(entry.clockOut).toLocaleString() : (
                              <span style={{ color: '#27ae60', fontWeight: '600' }}>In Progress</span>
                            )}
                          </td>
                          <td style={{ padding: '1rem' }}>
                            <span style={{
                              padding: '0.25rem 0.75rem',
                              borderRadius: '20px',
                              fontSize: '0.85rem',
                              background: '#e3f2fd',
                              color: '#1565c0'
                            }}>
                              {entry.activityType}
                            </span>
                          </td>
                          <td style={{ padding: '1rem', maxWidth: '200px' }}>
                            <span style={{ 
                              fontSize: '0.9rem',
                              color: entry.notes ? '#2c3e50' : '#999',
                              fontStyle: entry.notes ? 'normal' : 'italic'
                            }}>
                              {entry.notes || 'No notes'}
                            </span>
                          </td>
                          <td style={{ padding: '1rem', fontWeight: '600' }}>
                            {formatDuration(duration)}
                          </td>
                          <td style={{ padding: '1rem' }}>
                            <div style={{ display: 'flex', gap: '0.5rem' }}>
                              <button
                                onClick={() => setEditingEntry(entry)}
                                style={{
                                  padding: '0.5rem',
                                  background: '#3498db',
                                  color: 'white',
                                  border: 'none',
                                  borderRadius: '6px',
                                  cursor: 'pointer'
                                }}
                              >
                                <Edit2 size={16} />
                              </button>
                              <button
                                onClick={() => handleDeleteEntry(entry.id)}
                                style={{
                                  padding: '0.5rem',
                                  background: '#e74c3c',
                                  color: 'white',
                                  border: 'none',
                                  borderRadius: '6px',
                                  cursor: 'pointer'
                                }}
                              >
                                <Trash2 size={16} />
                              </button>
                            </div>
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
            </div>

            {/* Edit Entry Modal */}
            {editingEntry && (
              <div
                style={{
                  position: 'fixed',
                  top: 0,
                  left: 0,
                  right: 0,
                  bottom: 0,
                  background: 'rgba(0,0,0,0.7)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  zIndex: 1000,
                  padding: '2rem'
                }}
                onClick={() => setEditingEntry(null)}
              >
                <div
                  style={{
                    background: 'white',
                    borderRadius: '16px',
                    padding: '2rem',
                    maxWidth: '600px',
                    width: '100%',
                    maxHeight: '90vh',
                    overflowY: 'auto',
                    border: '3px solid #D4AF37'
                  }}
                  onClick={(e) => e.stopPropagation()}
                >
                  <h3 style={{ margin: '0 0 1.5rem 0', fontSize: '1.5rem', color: '#8B1A1A' }}>
                    Edit Time Entry
                  </h3>
                  
                  <div style={{ marginBottom: '1rem' }}>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                      Member
                    </label>
                    <div style={{ padding: '0.75rem', background: '#f5f5f5', borderRadius: '8px', fontWeight: '600' }}>
                      {members.find(m => m.id === editingEntry.memberId)?.name || 'Unknown'}
                    </div>
                  </div>

                  <div style={{ marginBottom: '1rem' }}>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                      Clock In *
                    </label>
                    <input
                      id="edit-entry-clockin"
                      type="datetime-local"
                      defaultValue={new Date(editingEntry.clockIn).toISOString().slice(0, 16)}
                      style={{
                        width: '100%',
                        padding: '0.75rem',
                        borderRadius: '8px',
                        border: '2px solid #e0e0e0',
                        fontSize: '1rem'
                      }}
                    />
                  </div>

                  <div style={{ marginBottom: '1rem' }}>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                      Clock Out
                    </label>
                    <input
                      id="edit-entry-clockout"
                      type="datetime-local"
                      defaultValue={editingEntry.clockOut ? new Date(editingEntry.clockOut).toISOString().slice(0, 16) : ''}
                      style={{
                        width: '100%',
                        padding: '0.75rem',
                        borderRadius: '8px',
                        border: '2px solid #e0e0e0',
                        fontSize: '1rem'
                      }}
                    />
                  </div>

                  <div style={{ marginBottom: '1rem' }}>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                      Activity Type *
                    </label>
                    <select
                      id="edit-entry-activity"
                      defaultValue={editingEntry.activityType}
                      style={{
                        width: '100%',
                        padding: '0.75rem',
                        borderRadius: '8px',
                        border: '2px solid #e0e0e0',
                        fontSize: '1rem'
                      }}
                    >
                      {activityTypes.map(type => (
                        <option key={type} value={type}>{type}</option>
                      ))}
                    </select>
                  </div>

                  <div style={{ marginBottom: '1.5rem' }}>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                      Notes
                    </label>
                    <textarea
                      id="edit-entry-notes"
                      defaultValue={editingEntry.notes || ''}
                      placeholder="Optional notes about this time entry"
                      style={{
                        width: '100%',
                        padding: '0.75rem',
                        borderRadius: '8px',
                        border: '2px solid #e0e0e0',
                        fontSize: '1rem',
                        minHeight: '100px',
                        fontFamily: 'inherit',
                        resize: 'vertical'
                      }}
                    />
                  </div>

                  <div style={{ display: 'flex', gap: '0.5rem' }}>
                    <button
                      onClick={() => {
                        const clockIn = document.getElementById('edit-entry-clockin')?.value;
                        const clockOut = document.getElementById('edit-entry-clockout')?.value;
                        const activityType = document.getElementById('edit-entry-activity')?.value;
                        const notes = document.getElementById('edit-entry-notes')?.value;

                        if (!clockIn || !activityType) {
                          alert('Please fill in Clock In and Activity Type');
                          return;
                        }

                        const updatedEntry = {
                          ...editingEntry,
                          clockIn: new Date(clockIn).toISOString(),
                          clockOut: clockOut ? new Date(clockOut).toISOString() : null,
                          activityType: activityType,
                          notes: notes || ''
                        };

                        handleUpdateEntry(updatedEntry);
                      }}
                      style={{
                        flex: 1,
                        padding: '0.875rem',
                        background: '#27ae60',
                        color: 'white',
                        border: 'none',
                        borderRadius: '8px',
                        cursor: 'pointer',
                        fontSize: '1rem',
                        fontWeight: 'bold',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '0.5rem'
                      }}
                    >
                      <Save size={20} />
                      Save Changes
                    </button>
                    <button
                      onClick={() => setEditingEntry(null)}
                      style={{
                        flex: 1,
                        padding: '0.875rem',
                        background: '#95a5a6',
                        color: 'white',
                        border: 'none',
                        borderRadius: '8px',
                        cursor: 'pointer',
                        fontSize: '1rem',
                        fontWeight: 'bold',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '0.5rem'
                      }}
                    >
                      <X size={20} />
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        )}

        {/* Announcements Tab */}
        {selectedTab === 'Announcements' && (
          <div>
            <div style={{
              background: 'white',
              padding: '2rem',
              borderRadius: '12px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
              border: '2px solid #D4AF37'
            }}>
              <h3 style={{ margin: '0 0 1.5rem 0', fontSize: '1.5rem', color: '#8B1A1A' }}>
                ðŸ“¢ Station Announcement
              </h3>
              <p style={{ marginBottom: '1rem', color: '#666' }}>
                This message will be displayed on the main clock screen for all members to see.
              </p>
              
              <div style={{ marginBottom: '1rem' }}>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '1rem', fontWeight: '600' }}>
                  Announcement Message
                </label>
                <textarea
                  id="announcement-text"
                  defaultValue={announcement}
                  placeholder="Example: Station Cleanup February - Jason K, Mark O, Dean S, Caleb P"
                  style={{
                    width: '100%',
                    padding: '1rem',
                    borderRadius: '8px',
                    border: '2px solid #e0e0e0',
                    fontSize: '1rem',
                    minHeight: '120px',
                    fontFamily: 'inherit',
                    resize: 'vertical'
                  }}
                />
              </div>

              <div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap' }}>
                <button
                  onClick={async () => {
                    const text = document.getElementById('announcement-text')?.value || '';
                    setAnnouncement(text);
                    try {
                      await window.storage.set('irfd-announcement', text, true);
                      alert(text ? 'Announcement updated successfully!' : 'Announcement cleared!');
                    } catch (error) {
                      console.error('Error saving announcement:', error);
                      alert('Error saving announcement');
                    }
                  }}
                  style={{
                    padding: '0.875rem 1.5rem',
                    background: '#27ae60',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    fontSize: '1rem',
                    fontWeight: 'bold',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0.5rem'
                  }}
                >
                  <Save size={20} />
                  Save Announcement
                </button>

                <button
                  onClick={async () => {
                    document.getElementById('announcement-text').value = '';
                    setAnnouncement('');
                    try {
                      await window.storage.set('irfd-announcement', '', true);
                      alert('Announcement cleared!');
                    } catch (error) {
                      console.error('Error clearing announcement:', error);
                    }
                  }}
                  style={{
                    padding: '0.875rem 1.5rem',
                    background: '#e74c3c',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    fontSize: '1rem',
                    fontWeight: 'bold',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0.5rem'
                  }}
                >
                  <X size={20} />
                  Clear Announcement
                </button>
              </div>

              {/* Preview */}
              <div style={{ marginTop: '2rem', paddingTop: '2rem', borderTop: '2px solid #e0e0e0' }}>
                <h4 style={{ margin: '0 0 1rem 0', fontSize: '1.2rem', color: '#8B1A1A' }}>
                  Preview (as shown on main clock screen):
                </h4>
                {announcement ? (
                  <div style={{
                    background: 'linear-gradient(135deg, #3498db 0%, #2980b9 100%)',
                    color: 'white',
                    padding: '1.5rem',
                    borderRadius: '12px',
                    boxShadow: '0 4px 12px rgba(52, 152, 219, 0.3)',
                    border: '2px solid #D4AF37'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                      <div style={{ fontSize: '2rem' }}>ðŸ“¢</div>
                      <div style={{ flex: 1 }}>
                        <h3 style={{ margin: '0 0 0.5rem 0', fontSize: '1.2rem', fontWeight: 'bold' }}>
                          Station Announcement
                        </h3>
                        <p style={{ margin: 0, fontSize: '1rem', lineHeight: '1.5' }}>
                          {announcement}
                        </p>
                      </div>
                    </div>
                  </div>
                ) : (
                  <div style={{
                    padding: '2rem',
                    background: '#f5f5f5',
                    borderRadius: '8px',
                    textAlign: 'center',
                    color: '#999',
                    fontStyle: 'italic'
                  }}>
                    No announcement set. Members will not see a banner on the main screen.
                  </div>
                )}
              </div>
            </div>
          </div>
        )}

        {/* Calendar Tab */}
        {selectedTab === 'Calendar' && (
          <div>
            {/* Add New Event */}
            <div style={{
              background: 'white',
              padding: '2rem',
              borderRadius: '12px',
              marginBottom: '2rem',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
              border: '2px solid #D4AF37'
            }}>
              <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.3rem', color: '#8B1A1A' }}>
                <Plus size={20} style={{ verticalAlign: 'middle', marginRight: '0.5rem' }} />
                Add Calendar Event
              </h3>

              {/* Event Type Selection */}
              <div style={{ marginBottom: '1.5rem' }}>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '1rem', fontWeight: '600' }}>
                  Event Type
                </label>
                <div style={{ display: 'flex', gap: '1rem' }}>
                  <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer' }}>
                    <input
                      type="radio"
                      name="event-type"
                      value="single"
                      defaultChecked
                      onChange={(e) => {
                        document.getElementById('recurring-options').style.display = 'none';
                        document.getElementById('event-date-container').style.display = 'block';
                      }}
                    />
                    <span>Single Event</span>
                  </label>
                  <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer' }}>
                    <input
                      type="radio"
                      name="event-type"
                      value="recurring"
                      onChange={(e) => {
                        document.getElementById('recurring-options').style.display = 'block';
                        document.getElementById('event-date-container').style.display = 'none';
                      }}
                    />
                    <span>ðŸ”„ Recurring Event</span>
                  </label>
                </div>
              </div>

              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem', marginBottom: '1rem' }}>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Event Title *
                  </label>
                  <input
                    id="event-title"
                    type="text"
                    placeholder="e.g., Fire Drill, Board Meeting"
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  />
                </div>

                {/* Single Event Date */}
                <div id="event-date-container">
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Date *
                  </label>
                  <input
                    id="event-date"
                    type="date"
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  />
                </div>

                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Time (Optional)
                  </label>
                  <input
                    id="event-time"
                    type="time"
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  />
                </div>
              </div>

              {/* Recurring Event Options */}
              <div id="recurring-options" style={{ display: 'none', marginBottom: '1rem', padding: '1rem', background: '#f0f8ff', borderRadius: '8px', border: '2px solid #3498db' }}>
                <h4 style={{ margin: '0 0 1rem 0', color: '#3498db' }}>ðŸ”„ Recurring Event Settings</h4>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem' }}>
                  <div>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                      Frequency *
                    </label>
                    <select
                      id="recurrence-frequency"
                      onChange={(e) => {
                        const freq = e.target.value;
                        const weekContainer = document.getElementById('recurrence-week-container');
                        const dayContainer = document.getElementById('recurrence-day-container');
                        const intervalContainer = document.getElementById('recurrence-interval-container');
                        
                        if (freq === 'weekly' || freq === 'biweekly') {
                          weekContainer.style.display = 'none';
                          dayContainer.style.display = 'block';
                          intervalContainer.style.display = 'none';
                        } else if (freq === 'monthly' || freq === 'bimonthly') {
                          weekContainer.style.display = 'block';
                          dayContainer.style.display = 'block';
                          intervalContainer.style.display = 'none';
                        } else {
                          weekContainer.style.display = 'none';
                          dayContainer.style.display = 'none';
                          intervalContainer.style.display = 'none';
                        }
                      }}
                      style={{
                        width: '100%',
                        padding: '0.75rem',
                        borderRadius: '8px',
                        border: '2px solid #e0e0e0',
                        fontSize: '1rem'
                      }}
                    >
                      <option value="weekly">Weekly (Every week)</option>
                      <option value="biweekly">Bi-Weekly (Every 2 weeks)</option>
                      <option value="monthly">Monthly (Every month)</option>
                      <option value="bimonthly">Bi-Monthly (Every 2 months)</option>
                    </select>
                  </div>

                  <div id="recurrence-week-container">
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                      Week of Month *
                    </label>
                    <select
                      id="recurrence-week"
                      style={{
                        width: '100%',
                        padding: '0.75rem',
                        borderRadius: '8px',
                        border: '2px solid #e0e0e0',
                        fontSize: '1rem'
                      }}
                    >
                      <option value="1">1st (First week)</option>
                      <option value="2">2nd (Second week)</option>
                      <option value="3">3rd (Third week)</option>
                      <option value="4">4th (Fourth week)</option>
                      <option value="-1">Last (Last week)</option>
                    </select>
                  </div>

                  <div id="recurrence-day-container">
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                      Day of Week *
                    </label>
                    <select
                      id="recurrence-day"
                      style={{
                        width: '100%',
                        padding: '0.75rem',
                        borderRadius: '8px',
                        border: '2px solid #e0e0e0',
                        fontSize: '1rem'
                      }}
                    >
                      <option value="0">Sunday</option>
                      <option value="1">Monday</option>
                      <option value="2">Tuesday</option>
                      <option value="3">Wednesday</option>
                      <option value="4">Thursday</option>
                      <option value="5">Friday</option>
                      <option value="6">Saturday</option>
                    </select>
                  </div>
                </div>
                <p style={{ margin: '0.5rem 0 0 0', fontSize: '0.85rem', color: '#666', fontStyle: 'italic' }}>
                  Examples: 
                  <br/>â€¢ Weekly/Bi-Weekly: Choose day (e.g., "Every Monday" or "Every other Tuesday")
                  <br/>â€¢ Monthly/Bi-Monthly: Choose week + day (e.g., "3rd Monday every month" or "Last Wednesday every 2 months")
                </p>
              </div>

              <div style={{ marginBottom: '1rem' }}>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                  Description (Optional)
                </label>
                <textarea
                  id="event-description"
                  placeholder="Event details, location, requirements, etc."
                  style={{
                    width: '100%',
                    padding: '0.75rem',
                    borderRadius: '8px',
                    border: '2px solid #e0e0e0',
                    fontSize: '1rem',
                    minHeight: '100px',
                    fontFamily: 'inherit',
                    resize: 'vertical'
                  }}
                />
              </div>

              <button
                onClick={() => {
                  console.log('Add Event button clicked');
                  const title = document.getElementById('event-title')?.value;
                  const eventType = document.querySelector('input[name="event-type"]:checked')?.value;
                  const time = document.getElementById('event-time')?.value;
                  const description = document.getElementById('event-description')?.value;

                  console.log('Form values:', { title, eventType, time, description });

                  if (!title) {
                    alert('Please fill in Event Title');
                    return;
                  }

                  let newEvent;

                  if (eventType === 'recurring') {
                    const frequency = document.getElementById('recurrence-frequency')?.value;
                    const weekOfMonth = parseInt(document.getElementById('recurrence-week')?.value);
                    const dayOfWeek = parseInt(document.getElementById('recurrence-day')?.value);

                    newEvent = {
                      id: Date.now().toString(),
                      title,
                      time: time || null,
                      description: description || '',
                      isRecurring: true,
                      recurrenceRule: {
                        type: frequency,
                        weekOfMonth: weekOfMonth,
                        dayOfWeek: dayOfWeek
                      }
                    };
                  } else {
                    const date = document.getElementById('event-date')?.value;
                    if (!date) {
                      alert('Please fill in the Event Date');
                      return;
                    }

                    newEvent = {
                      id: Date.now().toString(),
                      title,
                      date,
                      time: time || null,
                      description: description || '',
                      isRecurring: false
                    };
                  }

                  console.log('New event:', newEvent);
                  saveCalendarEvents([...calendarEvents, newEvent]);

                  // Clear form
                  document.getElementById('event-title').value = '';
                  if (document.getElementById('event-date')) {
                    document.getElementById('event-date').value = '';
                  }
                  document.getElementById('event-time').value = '';
                  document.getElementById('event-description').value = '';
                  const singleRadio = document.querySelector('input[name="event-type"][value="single"]');
                  if (singleRadio) singleRadio.checked = true;
                  const recurringOptions = document.getElementById('recurring-options');
                  if (recurringOptions) recurringOptions.style.display = 'none';
                  const dateContainer = document.getElementById('event-date-container');
                  if (dateContainer) dateContainer.style.display = 'block';

                  alert('Event added successfully!');
                }}
                style={{
                  padding: '0.875rem 1.5rem',
                  background: '#27ae60',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  fontSize: '1rem',
                  fontWeight: 'bold',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '0.5rem'
                }}
              >
                <Plus size={20} />
                Add Event
              </button>
            </div>

            {/* Events List */}
            <div style={{
              background: 'white',
              padding: '2rem',
              borderRadius: '12px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
            }}>
              <h3 style={{ margin: '0 0 1.5rem 0', fontSize: '1.3rem' }}>
                All Events ({calendarEvents.length})
              </h3>
              {calendarEvents.length > 0 ? (
                <div style={{ display: 'grid', gap: '1rem' }}>
                  {calendarEvents.map(event => (
                    <div
                      key={event.id}
                      style={{
                        padding: '1.5rem',
                        border: '2px solid #e0e0e0',
                        borderRadius: '12px',
                        background: event.isRecurring ? '#f0f8ff' : '#f9f9f9'
                      }}
                    >
                      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', flexWrap: 'wrap', gap: '1rem' }}>
                        <div style={{ flex: 1 }}>
                          <h4 style={{ margin: '0 0 0.5rem 0', fontSize: '1.2rem', color: '#8B1A1A' }}>
                            {event.title}
                            {event.isRecurring && (
                              <span style={{
                                marginLeft: '0.75rem',
                                padding: '0.25rem 0.75rem',
                                background: '#3498db',
                                color: 'white',
                                borderRadius: '12px',
                                fontSize: '0.75rem',
                                fontWeight: 'bold'
                              }}>
                                ðŸ”„ RECURRING
                              </span>
                            )}
                          </h4>
                          {event.isRecurring ? (
                            <div style={{ marginBottom: '0.5rem' }}>
                              <span style={{ fontSize: '0.9rem', color: '#3498db', fontWeight: '600' }}>
                                Repeats: {
                                  event.recurrenceRule.weekOfMonth === -1 ? 'Last' :
                                  event.recurrenceRule.weekOfMonth === 1 ? '1st' :
                                  event.recurrenceRule.weekOfMonth === 2 ? '2nd' :
                                  event.recurrenceRule.weekOfMonth === 3 ? '3rd' : '4th'
                                } {
                                  ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][event.recurrenceRule.dayOfWeek]
                                } of every month
                              </span>
                              {event.time && (
                                <span style={{ fontSize: '0.9rem', color: '#666', marginLeft: '1rem' }}>
                                  ðŸ• {event.time}
                                </span>
                              )}
                            </div>
                          ) : (
                            <div style={{ display: 'flex', gap: '1rem', marginBottom: '0.5rem', flexWrap: 'wrap' }}>
                              <span style={{ fontSize: '0.9rem', color: '#666' }}>
                                ðŸ“… {new Date(event.date).toLocaleDateString()}
                              </span>
                              {event.time && (
                                <span style={{ fontSize: '0.9rem', color: '#666' }}>
                                  ðŸ• {event.time}
                                </span>
                              )}
                            </div>
                          )}
                          <p style={{ margin: 0, color: '#555', fontSize: '0.95rem' }}>
                            {event.description}
                          </p>
                        </div>
                        <div style={{ display: 'flex', gap: '0.5rem' }}>
                          <button
                            onClick={() => setEditingCalendarEvent(event)}
                            style={{
                              padding: '0.5rem',
                              background: '#3498db',
                              color: 'white',
                              border: 'none',
                              borderRadius: '6px',
                              cursor: 'pointer'
                            }}
                          >
                            <Edit2 size={16} />
                          </button>
                          <button
                            onClick={() => {
                              saveCalendarEvents(calendarEvents.filter(e => e.id !== event.id));
                              alert('Event deleted!');
                            }}
                            style={{
                              padding: '0.5rem',
                              background: '#e74c3c',
                              color: 'white',
                              border: 'none',
                              borderRadius: '6px',
                              cursor: 'pointer'
                            }}
                          >
                            <Trash2 size={16} />
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              ) : (
                <div style={{
                  padding: '3rem',
                  textAlign: 'center',
                  color: '#999',
                  fontSize: '1.1rem',
                  fontStyle: 'italic'
                }}>
                  No events added yet. Add your first event above!
                </div>
              )}
            </div>

            {/* Edit Event Modal */}
            {editingCalendarEvent && (
              <div
                style={{
                  position: 'fixed',
                  top: 0,
                  left: 0,
                  right: 0,
                  bottom: 0,
                  background: 'rgba(0,0,0,0.7)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  zIndex: 2000,
                  padding: '2rem'
                }}
                onClick={() => setEditingCalendarEvent(null)}
              >
                <div
                  style={{
                    background: 'white',
                    borderRadius: '16px',
                    padding: '2rem',
                    maxWidth: '700px',
                    width: '100%',
                    maxHeight: '90vh',
                    overflowY: 'auto',
                    border: '3px solid #D4AF37'
                  }}
                  onClick={(e) => e.stopPropagation()}
                >
                  <h3 style={{ margin: '0 0 1.5rem 0', fontSize: '1.5rem', color: '#8B1A1A' }}>
                    {editingCalendarEvent.instanceId ? 'Edit This Instance' : 'Edit Calendar Event'}
                  </h3>

                  {editingCalendarEvent.instanceId && (
                    <div style={{ marginBottom: '1rem', padding: '1rem', background: '#fff3cd', borderRadius: '8px', border: '2px solid #ffc107' }}>
                      <p style={{ margin: 0, fontSize: '0.9rem', color: '#856404', fontWeight: '600' }}>
                        ðŸ“… Editing Single Instance: {new Date(editingCalendarEvent.date).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}
                      </p>
                      <p style={{ margin: '0.5rem 0 0 0', fontSize: '0.8rem', color: '#856404' }}>
                        Changes will only apply to this occurrence. The recurring series will not be affected.
                      </p>
                    </div>
                  )}

                  {editingCalendarEvent.isRecurring && !editingCalendarEvent.instanceId ? (
                    <>
                      <div style={{ marginBottom: '1rem' }}>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                          Event Title *
                        </label>
                        <input
                          id="edit-event-title"
                          type="text"
                          defaultValue={editingCalendarEvent.title}
                          style={{
                            width: '100%',
                            padding: '0.75rem',
                            borderRadius: '8px',
                            border: '2px solid #e0e0e0',
                            fontSize: '1rem'
                          }}
                        />
                      </div>
                      <div style={{ marginBottom: '1rem', padding: '1rem', background: '#f0f8ff', borderRadius: '8px' }}>
                        <p style={{ margin: 0, fontSize: '0.9rem', color: '#3498db', fontWeight: '600' }}>
                          ðŸ”„ Recurring: {
                            editingCalendarEvent.recurrenceRule.type === 'weekly' ? 'Every week' :
                            editingCalendarEvent.recurrenceRule.type === 'biweekly' ? 'Every 2 weeks' :
                            editingCalendarEvent.recurrenceRule.type === 'monthly' ? 'Every month' :
                            'Every 2 months'
                          }
                          {(editingCalendarEvent.recurrenceRule.type === 'monthly' || editingCalendarEvent.recurrenceRule.type === 'bimonthly') && ` - ${
                            editingCalendarEvent.recurrenceRule.weekOfMonth === -1 ? 'Last' :
                            editingCalendarEvent.recurrenceRule.weekOfMonth === 1 ? '1st' :
                            editingCalendarEvent.recurrenceRule.weekOfMonth === 2 ? '2nd' :
                            editingCalendarEvent.recurrenceRule.weekOfMonth === 3 ? '3rd' : '4th'
                          }`} {['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][editingCalendarEvent.recurrenceRule.dayOfWeek]}
                        </p>
                        <p style={{ margin: '0.5rem 0 0 0', fontSize: '0.8rem', color: '#666', fontStyle: 'italic' }}>
                          Editing series title/time/description. Changes apply to ALL future occurrences.
                        </p>
                        <p style={{ margin: '0.5rem 0 0 0', fontSize: '0.8rem', color: '#666', fontStyle: 'italic' }}>
                          To edit a single occurrence, click on a specific date in the calendar view.
                        </p>
                      </div>
                    </>
                  ) : (
                    <>
                      <div style={{ marginBottom: '1rem' }}>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                          Event Title *
                        </label>
                        <input
                          id="edit-event-title"
                          type="text"
                          defaultValue={editingCalendarEvent.title}
                          style={{
                            width: '100%',
                            padding: '0.75rem',
                            borderRadius: '8px',
                            border: '2px solid #e0e0e0',
                            fontSize: '1rem'
                          }}
                        />
                      </div>
                      {!editingCalendarEvent.instanceId && (
                        <div style={{ marginBottom: '1rem' }}>
                          <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                            Date *
                          </label>
                          <input
                            id="edit-event-date"
                            type="date"
                            defaultValue={editingCalendarEvent.date}
                            style={{
                              width: '100%',
                              padding: '0.75rem',
                              borderRadius: '8px',
                              border: '2px solid #e0e0e0',
                              fontSize: '1rem'
                            }}
                          />
                        </div>
                      )}
                    </>
                  )}

                  <div style={{ marginBottom: '1rem' }}>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                      Time (Optional)
                    </label>
                    <input
                      id="edit-event-time"
                      type="time"
                      defaultValue={editingCalendarEvent.time || ''}
                      style={{
                        width: '100%',
                        padding: '0.75rem',
                        borderRadius: '8px',
                        border: '2px solid #e0e0e0',
                        fontSize: '1rem'
                      }}
                    />
                  </div>

                  <div style={{ marginBottom: '1.5rem' }}>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                      Description (Optional)
                    </label>
                    <textarea
                      id="edit-event-description"
                      defaultValue={editingCalendarEvent.description || ''}
                      style={{
                        width: '100%',
                        padding: '0.75rem',
                        borderRadius: '8px',
                        border: '2px solid #e0e0e0',
                        fontSize: '1rem',
                        minHeight: '100px',
                        fontFamily: 'inherit',
                        resize: 'vertical'
                      }}
                    />
                  </div>

                  <div style={{ display: 'flex', gap: '0.5rem' }}>
                    <button
                      onClick={() => {
                        const title = document.getElementById('edit-event-title')?.value;
                        const time = document.getElementById('edit-event-time')?.value;
                        const description = document.getElementById('edit-event-description')?.value;

                        if (!title) {
                          alert('Please fill in Event Title');
                          return;
                        }

                        // Check if editing a specific instance of a recurring event
                        if (editingCalendarEvent.instanceId) {
                          // Save as an override
                          const override = {
                            instanceId: editingCalendarEvent.instanceId,
                            changes: {
                              title,
                              time: time || null,
                              description: description || ''
                            }
                          };

                          // Remove existing override for this instance if any
                          const newOverrides = recurringEventOverrides.filter(o => o.instanceId !== editingCalendarEvent.instanceId);
                          newOverrides.push(override);
                          
                          saveRecurringEventOverrides(newOverrides);
                          setEditingCalendarEvent(null);
                          alert('Instance updated successfully! This change only affects this occurrence.');
                        } else {
                          // Regular event or recurring series edit
                          let updatedEvent = { ...editingCalendarEvent };
                          updatedEvent.title = title;
                          updatedEvent.time = time || null;
                          updatedEvent.description = description || '';

                          if (!editingCalendarEvent.isRecurring) {
                            const date = document.getElementById('edit-event-date')?.value;
                            if (!date) {
                              alert('Please fill in the Event Date');
                              return;
                            }
                            updatedEvent.date = date;
                          }

                          saveCalendarEvents(calendarEvents.map(e => e.id === updatedEvent.id ? updatedEvent : e));
                          setEditingCalendarEvent(null);
                          alert('Event updated successfully!');
                        }
                      }}
                      style={{
                        flex: 1,
                        padding: '0.875rem',
                        background: '#27ae60',
                        color: 'white',
                        border: 'none',
                        borderRadius: '8px',
                        cursor: 'pointer',
                        fontSize: '1rem',
                        fontWeight: 'bold',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '0.5rem'
                      }}
                    >
                      <Save size={20} />
                      Save Changes
                    </button>
                    <button
                      onClick={() => setEditingCalendarEvent(null)}
                      style={{
                        flex: 1,
                        padding: '0.875rem',
                        background: '#95a5a6',
                        color: 'white',
                        border: 'none',
                        borderRadius: '8px',
                        cursor: 'pointer',
                        fontSize: '1rem',
                        fontWeight: 'bold',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '0.5rem'
                      }}
                    >
                      <X size={20} />
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        )}
        {/* Admin Users Tab */}
        {selectedTab === 'Admin Users' && (
          <div>
            {/* Current Admin Info */}
            <div style={{
              background: 'white',
              padding: '1.5rem',
              borderRadius: '12px',
              marginBottom: '2rem',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
              border: '2px solid #3498db'
            }}>
              <h3 style={{ margin: '0 0 0.5rem 0', fontSize: '1.2rem', color: '#3498db' }}>
                Current Session
              </h3>
              <p style={{ margin: 0, color: '#666' }}>
                Logged in as: <strong>{currentAdmin?.username}</strong> ({currentAdmin?.role})
              </p>
            </div>

            {/* Add New Admin User */}
            <div style={{
              background: 'white',
              padding: '2rem',
              borderRadius: '12px',
              marginBottom: '2rem',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
              border: '2px solid #D4AF37'
            }}>
              <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.3rem', color: '#8B1A1A' }}>
                <Plus size={20} style={{ verticalAlign: 'middle', marginRight: '0.5rem' }} />
                Add Admin User
              </h3>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem', marginBottom: '1rem' }}>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Username *
                  </label>
                  <input
                    id="new-admin-username"
                    type="text"
                    placeholder="e.g., jsmith"
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  />
                </div>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Password *
                  </label>
                  <input
                    id="new-admin-password"
                    type="password"
                    placeholder="Password"
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  />
                </div>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Role *
                  </label>
                  <input
                    id="new-admin-role"
                    type="text"
                    placeholder="e.g., Admin, Chief"
                    defaultValue="Admin"
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  />
                </div>
              </div>
              <button
                onClick={() => {
                  const username = document.getElementById('new-admin-username')?.value;
                  const password = document.getElementById('new-admin-password')?.value;
                  const role = document.getElementById('new-admin-role')?.value;

                  if (!username || !password) {
                    alert('Please fill in Username and Password');
                    return;
                  }

                  if (adminUsers.find(u => u.username === username)) {
                    alert('Username already exists');
                    return;
                  }

                  const newAdmin = {
                    username,
                    password,
                    role: role || 'Admin'
                  };

                  saveAdminUsers([...adminUsers, newAdmin]);

                  // Clear form
                  document.getElementById('new-admin-username').value = '';
                  document.getElementById('new-admin-password').value = '';
                  document.getElementById('new-admin-role').value = 'Admin';

                  alert('Admin user added successfully!');
                }}
                style={{
                  padding: '0.875rem 1.5rem',
                  background: '#27ae60',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  fontSize: '1rem',
                  fontWeight: 'bold',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '0.5rem'
                }}
              >
                <Plus size={20} />
                Add Admin User
              </button>
            </div>

            {/* Admin Users List */}
            <div style={{
              background: 'white',
              padding: '2rem',
              borderRadius: '12px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
            }}>
              <h3 style={{ margin: '0 0 1.5rem 0', fontSize: '1.3rem' }}>
                Admin Users ({adminUsers.length})
              </h3>
              <div style={{ display: 'grid', gap: '1rem' }}>
                {adminUsers.map((user, idx) => (
                  <div
                    key={idx}
                    style={{
                      padding: '1.5rem',
                      border: '2px solid #e0e0e0',
                      borderRadius: '12px',
                      background: user.username === currentAdmin?.username ? '#e8f4f8' : '#f9f9f9'
                    }}
                  >
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '1rem' }}>
                      <div>
                        <h4 style={{ margin: '0 0 0.5rem 0', fontSize: '1.2rem', color: '#8B1A1A' }}>
                          {user.username}
                          {user.username === currentAdmin?.username && (
                            <span style={{
                              marginLeft: '0.75rem',
                              padding: '0.25rem 0.75rem',
                              background: '#3498db',
                              color: 'white',
                              borderRadius: '12px',
                              fontSize: '0.75rem',
                              fontWeight: 'bold'
                            }}>
                              YOU
                            </span>
                          )}
                        </h4>
                        <p style={{ margin: 0, color: '#666', fontSize: '0.9rem' }}>
                          Role: {user.role}
                        </p>
                        <p style={{ margin: '0.25rem 0 0 0', color: '#999', fontSize: '0.85rem', fontStyle: 'italic' }}>
                          Password: {'â€¢'.repeat(user.password.length)}
                        </p>
                      </div>
                      <div style={{ display: 'flex', gap: '0.5rem' }}>
                        <button
                          onClick={() => setChangingPasswordFor(user)}
                          style={{
                            padding: '0.5rem 1rem',
                            background: '#3498db',
                            color: 'white',
                            border: 'none',
                            borderRadius: '6px',
                            cursor: 'pointer',
                            fontSize: '0.9rem',
                            fontWeight: 'bold'
                          }}
                        >
                          <Edit2 size={16} style={{ verticalAlign: 'middle' }} /> Change Password
                        </button>
                        {adminUsers.length > 1 && (
                          <button
                            onClick={() => {
                              if (user.username === currentAdmin?.username) {
                                alert('You cannot delete your own account while logged in');
                                return;
                              }
                              saveAdminUsers(adminUsers.filter(u => u.username !== user.username));
                              alert('Admin user deleted!');
                            }}
                            style={{
                              padding: '0.5rem',
                              background: '#e74c3c',
                              color: 'white',
                              border: 'none',
                              borderRadius: '6px',
                              cursor: 'pointer'
                            }}
                          >
                            <Trash2 size={16} />
                          </button>
                        )}
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* Change Password Modal */}
            {changingPasswordFor && (
              <div
                style={{
                  position: 'fixed',
                  top: 0,
                  left: 0,
                  right: 0,
                  bottom: 0,
                  background: 'rgba(0,0,0,0.7)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  zIndex: 3000,
                  padding: '2rem'
                }}
                onClick={() => setChangingPasswordFor(null)}
              >
                <div
                  style={{
                    background: 'white',
                    borderRadius: '16px',
                    padding: '2rem',
                    maxWidth: '500px',
                    width: '100%',
                    border: '3px solid #D4AF37'
                  }}
                  onClick={(e) => e.stopPropagation()}
                >
                  <h3 style={{ margin: '0 0 1.5rem 0', fontSize: '1.5rem', color: '#8B1A1A' }}>
                    Change Password for {changingPasswordFor.username}
                  </h3>

                  <div style={{ marginBottom: '1.5rem' }}>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                      New Password *
                    </label>
                    <input
                      id="new-password-input"
                      type="password"
                      placeholder="Enter new password"
                      style={{
                        width: '100%',
                        padding: '0.75rem',
                        borderRadius: '8px',
                        border: '2px solid #e0e0e0',
                        fontSize: '1rem'
                      }}
                    />
                  </div>

                  <div style={{ marginBottom: '1.5rem' }}>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                      Confirm New Password *
                    </label>
                    <input
                      id="confirm-password-input"
                      type="password"
                      placeholder="Confirm new password"
                      style={{
                        width: '100%',
                        padding: '0.75rem',
                        borderRadius: '8px',
                        border: '2px solid #e0e0e0',
                        fontSize: '1rem'
                      }}
                    />
                  </div>

                  <div style={{ display: 'flex', gap: '0.5rem' }}>
                    <button
                      onClick={() => {
                        const newPassword = document.getElementById('new-password-input')?.value;
                        const confirmPassword = document.getElementById('confirm-password-input')?.value;

                        if (!newPassword || !confirmPassword) {
                          alert('Please fill in both password fields');
                          return;
                        }

                        if (newPassword !== confirmPassword) {
                          alert('Passwords do not match');
                          return;
                        }

                        if (newPassword.length < 6) {
                          alert('Password must be at least 6 characters');
                          return;
                        }

                        const updatedUsers = adminUsers.map(u => 
                          u.username === changingPasswordFor.username ? { ...u, password: newPassword } : u
                        );
                        saveAdminUsers(updatedUsers);
                        
                        // Update current admin if changing own password
                        if (changingPasswordFor.username === currentAdmin?.username) {
                          setCurrentAdmin({ ...currentAdmin, password: newPassword });
                        }
                        
                        setChangingPasswordFor(null);
                        alert('Password updated successfully!');
                      }}
                      style={{
                        flex: 1,
                        padding: '0.875rem',
                        background: '#27ae60',
                        color: 'white',
                        border: 'none',
                        borderRadius: '8px',
                        cursor: 'pointer',
                        fontSize: '1rem',
                        fontWeight: 'bold',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '0.5rem'
                      }}
                    >
                      <Save size={20} />
                      Update Password
                    </button>
                    <button
                      onClick={() => setChangingPasswordFor(null)}
                      style={{
                        flex: 1,
                        padding: '0.875rem',
                        background: '#95a5a6',
                        color: 'white',
                        border: 'none',
                        borderRadius: '8px',
                        cursor: 'pointer',
                        fontSize: '1rem',
                        fontWeight: 'bold',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '0.5rem'
                      }}
                    >
                      <X size={20} />
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        )}

        {/* Reports Tab */}
        {selectedTab === 'Reports' && (
          <div>
            {/* Report Filters */}
            <div style={{
              background: 'white',
              padding: '1.5rem',
              borderRadius: '12px',
              marginBottom: '2rem',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
            }}>
              <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.3rem' }}>Report Filters</h3>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem' }}>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Member
                  </label>
                  <select
                    value={filterMember}
                    onChange={(e) => setFilterMember(e.target.value)}
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  >
                    <option value="all">All Members</option>
                    {members.map(m => (
                      <option key={m.id} value={m.id}>{m.name}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Activity Type
                  </label>
                  <select
                    value={filterActivity}
                    onChange={(e) => setFilterActivity(e.target.value)}
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  >
                    <option value="all">All Activities</option>
                    {activityTypes.map(type => (
                      <option key={type} value={type}>{type}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    Start Date
                  </label>
                  <input
                    type="date"
                    value={dateRange.start}
                    onChange={(e) => setDateRange({...dateRange, start: e.target.value})}
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  />
                </div>
                <div>
                  <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.9rem', fontWeight: '500' }}>
                    End Date
                  </label>
                  <input
                    type="date"
                    value={dateRange.end}
                    onChange={(e) => setDateRange({...dateRange, end: e.target.value})}
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      borderRadius: '8px',
                      border: '2px solid #e0e0e0',
                      fontSize: '1rem'
                    }}
                  />
                </div>
              </div>
              
              {/* Export/Print Buttons */}
              <div style={{ 
                display: 'flex', 
                gap: '1rem', 
                marginTop: '1.5rem',
                paddingTop: '1.5rem',
                borderTop: '2px solid #e0e0e0',
                flexWrap: 'wrap'
              }}>
                <button
                  onClick={exportToCSV}
                  style={{
                    flex: 1,
                    minWidth: '200px',
                    padding: '1rem 2rem',
                    background: '#27ae60',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    fontSize: '1rem',
                    fontWeight: '600',
                    cursor: 'pointer',
                    display: 'inline-flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '0.5rem'
                  }}
                >
                  <Download size={20} />
                  Download CSV
                </button>
                <button
                  onClick={printReport}
                  style={{
                    flex: 1,
                    minWidth: '200px',
                    padding: '1rem 2rem',
                    background: '#3498db',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    fontSize: '1rem',
                    fontWeight: '600',
                    cursor: 'pointer',
                    display: 'inline-flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '0.5rem'
                  }}
                >
                  ðŸ–¨ï¸ Print Report
                </button>
              </div>
              <p style={{ marginTop: '1rem', color: '#666', fontSize: '0.9rem', textAlign: 'center' }}>
                â„¹ï¸ Export and print will only include entries matching the filters above
              </p>
            </div>

            {/* Hours by Member */}
            <div style={{
              background: 'white',
              padding: '2rem',
              borderRadius: '12px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
              marginBottom: '2rem'
            }}>
              <h3 style={{ margin: '0 0 1.5rem 0', fontSize: '1.5rem' }}>Hours by Member</h3>
              
              <div style={{
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
                gap: '1.5rem',
                marginBottom: '2rem'
              }}>
                {members
                  .filter(member => filterMember === 'all' || member.id === filterMember)
                  .map(member => {
                    const hours = calculateTotalHours(
                      member.id,
                      dateRange.start || null,
                      dateRange.end || null
                    );
                    
                    // Filter by activity if needed
                    let filteredHours = hours;
                    if (filterActivity !== 'all') {
                      const relevantEntries = timeEntries.filter(e => 
                        e.memberId === member.id && 
                        e.activityType === filterActivity &&
                        (!dateRange.start || !dateRange.end || 
                          (new Date(e.clockIn) >= new Date(dateRange.start) && 
                           new Date(e.clockIn) <= new Date(dateRange.end)))
                      );
                      filteredHours = relevantEntries.reduce((total, entry) => {
                        if (entry.clockOut) {
                          const h = (new Date(entry.clockOut) - new Date(entry.clockIn)) / (1000 * 60 * 60);
                          return total + h;
                        } else {
                          const h = (new Date() - new Date(entry.clockIn)) / (1000 * 60 * 60);
                          return total + h;
                        }
                      }, 0);
                    }
                    
                    return (
                      <div
                        key={member.id}
                        style={{
                          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                          color: 'white',
                          padding: '1.5rem',
                          borderRadius: '12px',
                          boxShadow: '0 4px 12px rgba(102, 126, 234, 0.3)'
                        }}
                      >
                        <div style={{ fontSize: '1.1rem', fontWeight: '600', marginBottom: '0.5rem' }}>
                          {member.name}
                        </div>
                        <div style={{ fontSize: '0.9rem', opacity: 0.9, marginBottom: '1rem' }}>
                          Badge #{member.badgeNumber}
                        </div>
                        <div style={{ fontSize: '2rem', fontWeight: 'bold' }}>
                          {formatDuration(filteredHours)}
                        </div>
                      </div>
                    );
                  })}
              </div>
            </div>

            {/* Hours by Activity Type */}
            <div style={{
              background: 'white',
              padding: '2rem',
              borderRadius: '12px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
              marginBottom: '2rem'
            }}>
              <h3 style={{ margin: '0 0 1.5rem 0', fontSize: '1.5rem' }}>Hours by Activity Type</h3>
              
              <div style={{
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
                gap: '1.5rem',
                marginBottom: '2rem'
              }}>
                {activityTypes
                  .filter(type => filterActivity === 'all' || type === filterActivity)
                  .map(activityType => {
                    const relevantEntries = timeEntries.filter(e => {
                      const matchesActivity = e.activityType === activityType;
                      const matchesMember = filterMember === 'all' || e.memberId === filterMember;
                      const matchesDate = !dateRange.start || !dateRange.end || 
                        (new Date(e.clockIn) >= new Date(dateRange.start) && 
                         new Date(e.clockIn) <= new Date(dateRange.end));
                      return matchesActivity && matchesMember && matchesDate;
                    });
                    
                    const totalHours = relevantEntries.reduce((total, entry) => {
                      if (entry.clockOut) {
                        const h = (new Date(entry.clockOut) - new Date(entry.clockIn)) / (1000 * 60 * 60);
                        return total + h;
                      } else {
                        const h = (new Date() - new Date(entry.clockIn)) / (1000 * 60 * 60);
                        return total + h;
                      }
                    }, 0);
                    
                    return (
                      <div
                        key={activityType}
                        style={{
                          background: 'linear-gradient(135deg, #27ae60 0%, #229954 100%)',
                          color: 'white',
                          padding: '1.5rem',
                          borderRadius: '12px',
                          boxShadow: '0 4px 12px rgba(39, 174, 96, 0.3)'
                        }}
                      >
                        <div style={{ fontSize: '1.1rem', fontWeight: '600', marginBottom: '0.5rem' }}>
                          {activityType}
                        </div>
                        <div style={{ fontSize: '0.9rem', opacity: 0.9, marginBottom: '1rem' }}>
                          {relevantEntries.length} entries
                        </div>
                        <div style={{ fontSize: '2rem', fontWeight: 'bold' }}>
                          {formatDuration(totalHours)}
                        </div>
                      </div>
                    );
                  })}
              </div>
            </div>
          </div>
        )}
      </div>
    );
  };

  const [selectedTab, setSelectedTab] = useState('Members');

  return (
    <div style={{
      minHeight: '100vh',
      background: '#f5f7fa',
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'
    }}>
      <style>{`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
        * { box-sizing: border-box; }
      `}</style>
      
      {view === 'clock' ? <ClockView /> : view === 'calendar' ? <CalendarView /> : <AdminView />}
    </div>
  );
};

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TimeClockApp />);
    </script>
</body>
</html>
